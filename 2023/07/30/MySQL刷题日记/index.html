<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SQL刷题日记 | JavaMdd</title><meta name="author" content="Java Mdd"><meta name="copyright" content="Java Mdd"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="查询584. 寻找用户推荐人123456789101112131415161718192021222324给定表 customer ，里面保存了所有客户信息和他们的推荐人。+------+------+-----------+| id   | name | referee_id|+------+------+-----------+|    1 | Will |      NULL ||    2">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL刷题日记">
<meta property="og:url" content="http://example.com/2023/07/30/MySQL%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/index.html">
<meta property="og:site_name" content="JavaMdd">
<meta property="og:description" content="查询584. 寻找用户推荐人123456789101112131415161718192021222324给定表 customer ，里面保存了所有客户信息和他们的推荐人。+------+------+-----------+| id   | name | referee_id|+------+------+-----------+|    1 | Will |      NULL ||    2">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img1.imgtp.com/2023/07/24/XnYi7kOl.png">
<meta property="article:published_time" content="2023-07-30T13:56:04.006Z">
<meta property="article:modified_time" content="2023-07-30T17:31:52.228Z">
<meta property="article:author" content="Java Mdd">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img1.imgtp.com/2023/07/24/XnYi7kOl.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/07/30/MySQL%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":40,"languages":{"author":"作者: Java Mdd","link":"链接: ","source":"来源: JavaMdd","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SQL刷题日记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-07-31 01:31:52'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://img1.imgtp.com/2023/07/24/H1X3G9Nz.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://img1.imgtp.com/2023/07/24/XnYi7kOl.png')"><nav id="nav"><span id="blog-info"><a href="/" title="JavaMdd"><span class="site-name">JavaMdd</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SQL刷题日记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-30T13:56:04.006Z" title="发表于 2023-07-30 21:56:04">2023-07-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-07-30T17:31:52.228Z" title="更新于 2023-07-31 01:31:52">2023-07-31</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">14.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>61分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SQL刷题日记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h1><h2 id="584-寻找用户推荐人"><a href="#584-寻找用户推荐人" class="headerlink" title="584. 寻找用户推荐人"></a>584. 寻找用户推荐人</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">给定表 customer ，里面保存了所有客户信息和他们的推荐人。</span><br><span class="line"></span><br><span class="line">+------+------+-----------+</span><br><span class="line">| id   | name | referee_id|</span><br><span class="line">+------+------+-----------+</span><br><span class="line">|    1 | Will |      NULL |</span><br><span class="line">|    2 | Jane |      NULL |</span><br><span class="line">|    3 | Alex |         2 |</span><br><span class="line">|    4 | Bill |      NULL |</span><br><span class="line">|    5 | Zack |         1 |</span><br><span class="line">|    6 | Mark |         2 |</span><br><span class="line">+------+------+-----------+</span><br><span class="line">写一个查询语句，返回一个客户列表，列表中客户的推荐人的编号都 不是 2。</span><br><span class="line"></span><br><span class="line">对于上面的示例数据，结果为：</span><br><span class="line"></span><br><span class="line">+------+</span><br><span class="line">| name |</span><br><span class="line">+------+</span><br><span class="line">| Will |</span><br><span class="line">| Jane |</span><br><span class="line">| Bill |</span><br><span class="line">| Zack |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure>

<p>注意：sql里面的不等于不包含null,因为查询结果只会包含WHERE子句里的判断结果为true的行！不包含判断结果为false和unknown的行。且不仅是等号，对NULL使用其他比较谓词（比如&gt; NULL），结果也都是unknown。</p>
<p><strong><em><em>重点理解：</em></em></strong> **<em>NULL不是值，所以不能对其使用谓词，如果使用谓词，结果是unknown</em>**。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name </span><br><span class="line"><span class="keyword">from</span> customer</span><br><span class="line"><span class="keyword">where</span> referee_id <span class="operator">!=</span> <span class="number">2</span> <span class="keyword">or</span> referee_id <span class="keyword">is</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<h2 id="595-大的国家"><a href="#595-大的国家" class="headerlink" title="595. 大的国家"></a>595. 大的国家</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">World 表：</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| name        | varchar |</span><br><span class="line">| continent   | varchar |</span><br><span class="line">| area        | int     |</span><br><span class="line">| population  | int     |</span><br><span class="line">| gdp         | bigint  |</span><br><span class="line">+-------------+---------+</span><br><span class="line">name 是这张表的主键。</span><br><span class="line">这张表的每一行提供：国家名称、所属大陆、面积、人口和 GDP 值。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">如果一个国家满足下述两个条件之一，则认为该国是 大国 ：</span><br><span class="line"></span><br><span class="line">面积至少为 300 万平方公里（即，3000000 km2），或者</span><br><span class="line">人口至少为 2500 万（即 25000000）</span><br><span class="line">编写一个 SQL 查询以报告 大国 的国家名称、人口和面积。</span><br><span class="line"></span><br><span class="line">按 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式如下例所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">World 表：</span><br><span class="line">+-------------+-----------+---------+------------+--------------+</span><br><span class="line">| name        | continent | area    | population | gdp          |</span><br><span class="line">+-------------+-----------+---------+------------+--------------+</span><br><span class="line">| Afghanistan | Asia      | 652230  | 25500100   | 20343000000  |</span><br><span class="line">| Albania     | Europe    | 28748   | 2831741    | 12960000000  |</span><br><span class="line">| Algeria     | Africa    | 2381741 | 37100000   | 188681000000 |</span><br><span class="line">| Andorra     | Europe    | 468     | 78115      | 3712000000   |</span><br><span class="line">| Angola      | Africa    | 1246700 | 20609294   | 100990000000 |</span><br><span class="line">+-------------+-----------+---------+------------+--------------+</span><br><span class="line">输出：</span><br><span class="line">+-------------+------------+---------+</span><br><span class="line">| name        | population | area    |</span><br><span class="line">+-------------+------------+---------+</span><br><span class="line">| Afghanistan | 25500100   | 652230  |</span><br><span class="line">| Algeria     | 37100000   | 2381741 |</span><br><span class="line">+-------------+------------+---------+</span><br></pre></td></tr></table></figure>

<p>**解法一：OR	**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">name, population, area</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">world</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">area <span class="operator">&gt;=</span> <span class="number">3000000</span> <span class="keyword">OR</span> population <span class="operator">&gt;=</span> <span class="number">25000000</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p><strong>解法二：使用UNION连接子查询</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">name, population, area</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">world</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">area <span class="operator">&gt;=</span> <span class="number">3000000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">name, population, area</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">world</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">population <span class="operator">&gt;=</span> <span class="number">25000000</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>尽量去使用union，因为使用or可能会使索引失效，在数据量比较大的情况下尽量使用nion</p>
<p><strong>union 和union all的区别</strong></p>
<p>Union：对两个结果集进行并集操作，不包括重复行，同时进行默认规则的排序； 即：去重+排序</p>
<p>Union All：对两个结果集进行并集操作，包括重复行，不进行排序； 即：不去重+不排序</p>
<h2 id="1148-文章浏览-I"><a href="#1148-文章浏览-I" class="headerlink" title="1148. 文章浏览 I"></a>1148. 文章浏览 I</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Views 表：</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| article_id    | int     |</span><br><span class="line">| author_id     | int     |</span><br><span class="line">| viewer_id     | int     |</span><br><span class="line">| view_date     | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">此表无主键，因此可能会存在重复行。</span><br><span class="line">此表的每一行都表示某人在某天浏览了某位作者的某篇文章。</span><br><span class="line">请注意，同一人的 author_id 和 viewer_id 是相同的。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">请编写一条 SQL 查询以找出所有浏览过自己文章的作者，结果按照 id 升序排列。</span><br><span class="line"></span><br><span class="line">查询结果的格式如下所示：</span><br><span class="line"></span><br><span class="line">Views 表：</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line">| article_id | author_id | viewer_id | view_date  |</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line">| 1          | 3         | 5         | 2019-08-01 |</span><br><span class="line">| 1          | 3         | 6         | 2019-08-02 |</span><br><span class="line">| 2          | 7         | 7         | 2019-08-01 |</span><br><span class="line">| 2          | 7         | 6         | 2019-08-02 |</span><br><span class="line">| 4          | 7         | 1         | 2019-07-22 |</span><br><span class="line">| 3          | 4         | 4         | 2019-07-21 |</span><br><span class="line">| 3          | 4         | 4         | 2019-07-21 |</span><br><span class="line">+------------+-----------+-----------+------------+</span><br><span class="line"></span><br><span class="line">结果表：</span><br><span class="line">+------+</span><br><span class="line">| id   |</span><br><span class="line">+------+</span><br><span class="line">| 4    |</span><br><span class="line">| 7    |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure>

<p><strong>解法一：</strong></p>
<p>distinct 和 order by</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> author_id <span class="keyword">as</span> id </span><br><span class="line"><span class="keyword">from</span> Views</span><br><span class="line"><span class="keyword">where</span> author_id<span class="operator">=</span>viewer_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> author_id</span><br></pre></td></tr></table></figure>

<p><strong>小结：</strong></p>
<p>也可以使用group by 也可以去重，但是8.0之前group by 内部有隐式排序，所以效率distinct高</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span> author_id <span class="keyword">as</span> id </span><br><span class="line"><span class="keyword">from</span> Views</span><br><span class="line"><span class="keyword">where</span> author_id<span class="operator">=</span>viewer_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> author_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> author_id</span><br></pre></td></tr></table></figure>

<h2 id="1683-无效的推文"><a href="#1683-无效的推文" class="headerlink" title="1683. 无效的推文"></a>1683. 无效的推文</h2><p>表：<code>Tweets</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| tweet_id       | int     |</span><br><span class="line">| content        | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">tweet_id 是这个表的主键。</span><br><span class="line">这个表包含某社交媒体 App 中所有的推文。</span><br></pre></td></tr></table></figure>

<p>写一条 SQL 语句，查询所有无效推文的编号（ID）。当推文内容中的字符数<strong>严格大于</strong> <code>15</code> 时，该推文是无效的。</p>
<p>以<strong>任意顺序</strong>返回结果表。</p>
<p>查询结果格式如下示例所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Tweets 表：</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| tweet_id | content                          |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line">| 1        | Vote for Biden                   |</span><br><span class="line">| 2        | Let us make America great again! |</span><br><span class="line">+----------+----------------------------------+</span><br><span class="line"></span><br><span class="line">结果表：</span><br><span class="line">+----------+</span><br><span class="line">| tweet_id |</span><br><span class="line">+----------+</span><br><span class="line">| 2        |</span><br><span class="line">+----------+</span><br><span class="line">推文 1 的长度 length = 14。该推文是有效的。</span><br><span class="line">推文 2 的长度 length = 32。该推文是无效的。</span><br></pre></td></tr></table></figure>

<p><strong>解法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select tweet_id </span><br><span class="line">from Tweets </span><br><span class="line">where char_length(content)&gt;15;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong><br>1、char_length(str) （1）计算单位：字符 （2）不管汉字还是数字或者是字母都算是一个字符 2、length(str) （1）计算单位：字节 （2）utf8编码：一个汉字三个字节，一个数字或字母一个字节。（3）gbk编码：一个汉字两个字节，一个数字或字母一个字节。 3、本题用CHAR_LENGTH()</p>
<h1 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h1><h2 id="1378-使用唯一标识码替换员工ID"><a href="#1378-使用唯一标识码替换员工ID" class="headerlink" title="1378. 使用唯一标识码替换员工ID"></a>1378. 使用唯一标识码替换员工ID</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">Employees 表：</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | <span class="type">int</span>     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id 是这张表的主键。</span><br><span class="line">这张表的每一行分别代表了某公司其中一位员工的名字和 ID 。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">EmployeeUNI 表：</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | <span class="type">int</span>     |</span><br><span class="line">| unique_id     | <span class="type">int</span>     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(id, unique_id) 是这张表的主键。</span><br><span class="line">这张表的每一行包含了该公司某位员工的 ID 和他的唯一标识码（unique ID）。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">写一段SQL查询来展示每位用户的 唯一标识码（unique ID ）；如果某位员工没有唯一标识码，使用 <span class="literal">null</span> 填充即可。</span><br><span class="line"></span><br><span class="line">你可以以 任意 顺序返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果的格式如下例所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 <span class="number">1</span>：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Employees 表:</span><br><span class="line">+----+----------+</span><br><span class="line">| id | name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| <span class="number">1</span>  | Alice    |</span><br><span class="line">| <span class="number">7</span>  | Bob      |</span><br><span class="line">| <span class="number">11</span> | Meir     |</span><br><span class="line">| <span class="number">90</span> | Winston  |</span><br><span class="line">| <span class="number">3</span>  | Jonathan |</span><br><span class="line">+----+----------+</span><br><span class="line">EmployeeUNI 表:</span><br><span class="line">+----+-----------+</span><br><span class="line">| id | unique_id |</span><br><span class="line">+----+-----------+</span><br><span class="line">| <span class="number">3</span>  | <span class="number">1</span>         |</span><br><span class="line">| <span class="number">11</span> | <span class="number">2</span>         |</span><br><span class="line">| <span class="number">90</span> | <span class="number">3</span>         |</span><br><span class="line">+----+-----------+</span><br><span class="line">输出：</span><br><span class="line">+-----------+----------+</span><br><span class="line">| unique_id | name     |</span><br><span class="line">+-----------+----------+</span><br><span class="line">| <span class="literal">null</span>      | Alice    |</span><br><span class="line">| <span class="literal">null</span>      | Bob      |</span><br><span class="line">| <span class="number">2</span>         | Meir     |</span><br><span class="line">| <span class="number">3</span>         | Winston  |</span><br><span class="line">| <span class="number">1</span>         | Jonathan |</span><br><span class="line">+-----------+----------+</span><br><span class="line">解释：</span><br><span class="line">Alice and Bob 没有唯一标识码, 因此我们使用 <span class="literal">null</span> 替代。</span><br><span class="line">Meir 的唯一标识码是 <span class="number">2</span> 。</span><br><span class="line">Winston 的唯一标识码是 <span class="number">3</span> 。</span><br><span class="line">Jonathan 唯一标识码是 <span class="number">1</span> 。</span><br></pre></td></tr></table></figure>
<p><strong>解法：使用外连接</strong><br>解题思路：因为要显示所有员工，就算没有唯一标识码可以用null代替。所以我们可以用左外连接，「左外连接」用于不仅返回满足连接条件的所有记录，而且还返回不满足连接条件的连接操作符左边表的其他行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> unique_id,name </span><br><span class="line"><span class="keyword">from</span> Employees e</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> employeeuni en</span><br><span class="line"><span class="keyword">on</span> e.id <span class="operator">=</span> en.id;</span><br></pre></td></tr></table></figure>
<h2 id="1068-产品销售分析-I"><a href="#1068-产品销售分析-I" class="headerlink" title="1068. 产品销售分析 I"></a>1068. 产品销售分析 I</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">销售表 Sales：</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name <span class="operator">|</span> Type  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+-------+</span></span><br><span class="line"><span class="operator">|</span> sale_id     <span class="operator">|</span> <span class="type">int</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> product_id  <span class="operator">|</span> <span class="type">int</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">year</span>        <span class="operator">|</span> <span class="type">int</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> quantity    <span class="operator">|</span> <span class="type">int</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> price       <span class="operator">|</span> <span class="type">int</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+-------+</span></span><br><span class="line">(sale_id, <span class="keyword">year</span>) 是销售表 Sales 的主键.</span><br><span class="line">product_id 是关联到产品表 Product 的外键.</span><br><span class="line">注意: price 表示每单位价格</span><br><span class="line">产品表 Product：</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name  <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+---------+</span></span><br><span class="line"><span class="operator">|</span> product_id   <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> product_name <span class="operator">|</span> <span class="type">varchar</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+---------+</span></span><br><span class="line">product_id 是表的主键.</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">写一条<span class="keyword">SQL</span> 查询语句获取 Sales 表中所有产品对应的 产品名称 product_name 以及该产品的所有 售卖年份 <span class="keyword">year</span> 和 价格 price 。</span><br><span class="line"></span><br><span class="line">查询结果中的顺序无特定要求。</span><br><span class="line"></span><br><span class="line">查询结果格式示例如下：</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Sales 表：</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+------------+------+----------+-------+</span></span><br><span class="line"><span class="operator">|</span> sale_id <span class="operator">|</span> product_id <span class="operator">|</span> <span class="keyword">year</span> <span class="operator">|</span> quantity <span class="operator">|</span> price <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+------------+------+----------+-------+ </span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>       <span class="operator">|</span> <span class="number">100</span>        <span class="operator">|</span> <span class="number">2008</span> <span class="operator">|</span> <span class="number">10</span>       <span class="operator">|</span> <span class="number">5000</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>       <span class="operator">|</span> <span class="number">100</span>        <span class="operator">|</span> <span class="number">2009</span> <span class="operator">|</span> <span class="number">12</span>       <span class="operator">|</span> <span class="number">5000</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">7</span>       <span class="operator">|</span> <span class="number">200</span>        <span class="operator">|</span> <span class="number">2011</span> <span class="operator">|</span> <span class="number">15</span>       <span class="operator">|</span> <span class="number">9000</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+------------+------+----------+-------+</span></span><br><span class="line"></span><br><span class="line">Product 表：</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------------+</span></span><br><span class="line"><span class="operator">|</span> product_id <span class="operator">|</span> product_name <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">100</span>        <span class="operator">|</span> Nokia        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">200</span>        <span class="operator">|</span> Apple        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">300</span>        <span class="operator">|</span> Samsung      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Result</span> 表：</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+-------+-------+</span></span><br><span class="line"><span class="operator">|</span> product_name <span class="operator">|</span> <span class="keyword">year</span>  <span class="operator">|</span> price <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+-------+-------+</span></span><br><span class="line"><span class="operator">|</span> Nokia        <span class="operator">|</span> <span class="number">2008</span>  <span class="operator">|</span> <span class="number">5000</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Nokia        <span class="operator">|</span> <span class="number">2009</span>  <span class="operator">|</span> <span class="number">5000</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Apple        <span class="operator">|</span> <span class="number">2011</span>  <span class="operator">|</span> <span class="number">9000</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+-------+-------+</span></span><br></pre></td></tr></table></figure>
<p><strong>解法：连接</strong><br>解题思路：使用联表查询使用外连接和内连接都行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> p.product_name , s.year ,s.price</span><br><span class="line"><span class="keyword">from</span> Sales s <span class="keyword">join</span> Product p</span><br><span class="line"><span class="keyword">on</span> s.product_id<span class="operator">=</span>p.product_id</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> product_name , <span class="keyword">year</span>  , price</span><br><span class="line"><span class="keyword">from</span>  Sales <span class="keyword">join</span> Product <span class="keyword">using</span> (product_id)</span><br><span class="line"></span><br><span class="line">当两个表中的列具有相同的名称时，可以使用<span class="keyword">USING</span>()来简化连接条件的编写。</span><br></pre></td></tr></table></figure>
<p><strong>总结:</strong><br>在MySQL中，JOIN和LEFT JOIN是用于将两个或多个表连接在一起的操作。它们的区别在于对连接的处理方式。<br>JOIN（也称为INNER JOIN）将两个表中匹配的行连接在一起，只返回两个表中共有的行。如果某个表中的行在另一个表中没有匹配的行，则不会返回该行。<br>LEFT JOIN（也称为LEFT OUTER JOIN）将左边的表的所有行与右边的表进行连接，无论右边的表中是否有匹配的行。如果右边的表中没有匹配的行，则返回NULL值。<br>简而言之，JOIN只返回两个表中共有的行，而LEFT JOIN返回左边表的所有行以及与之匹配的右边表的行。</p>
<h2 id="1581-进店却未进行过交易的顾客"><a href="#1581-进店却未进行过交易的顾客" class="headerlink" title="1581. 进店却未进行过交易的顾客"></a>1581. 进店却未进行过交易的顾客</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">表：Visits</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line"><span class="operator">|</span> visit_id    <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> customer_id <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+---------+</span></span><br><span class="line">visit_id 是该表的主键。</span><br><span class="line">该表包含有关光临过购物中心的顾客的信息。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">表：Transactions</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name    <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line"><span class="operator">|</span> transaction_id <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> visit_id       <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> amount         <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line">transaction_id 是此表的主键。</span><br><span class="line">此表包含 visit_id 期间进行的交易的信息。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">有一些顾客可能光顾了购物中心但没有进行交易。请你编写一个 <span class="keyword">SQL</span> 查询，来查找这些顾客的 ID ，以及他们只光顾不交易的次数。</span><br><span class="line"></span><br><span class="line">返回以 任何顺序 排序的结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式如下例所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 <span class="number">1</span>：</span><br><span class="line"></span><br><span class="line">输入:</span><br><span class="line">Visits</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-------------+</span></span><br><span class="line"><span class="operator">|</span> visit_id <span class="operator">|</span> customer_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>        <span class="operator">|</span> <span class="number">23</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>        <span class="operator">|</span> <span class="number">9</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>        <span class="operator">|</span> <span class="number">30</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5</span>        <span class="operator">|</span> <span class="number">54</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6</span>        <span class="operator">|</span> <span class="number">96</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">7</span>        <span class="operator">|</span> <span class="number">54</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">8</span>        <span class="operator">|</span> <span class="number">54</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-------------+</span></span><br><span class="line">Transactions</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+----------+--------+</span></span><br><span class="line"><span class="operator">|</span> transaction_id <span class="operator">|</span> visit_id <span class="operator">|</span> amount <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+----------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>              <span class="operator">|</span> <span class="number">5</span>        <span class="operator">|</span> <span class="number">310</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>              <span class="operator">|</span> <span class="number">5</span>        <span class="operator">|</span> <span class="number">300</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">9</span>              <span class="operator">|</span> <span class="number">5</span>        <span class="operator">|</span> <span class="number">200</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">12</span>             <span class="operator">|</span> <span class="number">1</span>        <span class="operator">|</span> <span class="number">910</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">13</span>             <span class="operator">|</span> <span class="number">2</span>        <span class="operator">|</span> <span class="number">970</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+----------+--------+</span></span><br><span class="line">输出:</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+----------------+</span></span><br><span class="line"><span class="operator">|</span> customer_id <span class="operator">|</span> count_no_trans <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+----------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">54</span>          <span class="operator">|</span> <span class="number">2</span>              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">30</span>          <span class="operator">|</span> <span class="number">1</span>              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">96</span>          <span class="operator">|</span> <span class="number">1</span>              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+----------------+</span></span><br></pre></td></tr></table></figure>
<p><strong>解法：使用外连接</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> v.customer_id, <span class="built_in">count</span>(v.visit_id) <span class="keyword">as</span> count_no_trans</span><br><span class="line"><span class="keyword">from</span> visits v <span class="keyword">left</span> <span class="keyword">join</span> Transactions t</span><br><span class="line"><span class="keyword">on</span> v.visit_id<span class="operator">=</span>t.visit_id</span><br><span class="line"><span class="keyword">where</span> transaction_id <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_id</span><br></pre></td></tr></table></figure>
<h2 id="197-上升的温度"><a href="#197-上升的温度" class="headerlink" title="197. 上升的温度"></a>197. 上升的温度</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">表： Weather</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name   <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> id            <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> recordDate    <span class="operator">|</span> <span class="type">date</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> temperature   <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line">id 是这个表的主键</span><br><span class="line">该表包含特定日期的温度信息</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写一个 <span class="keyword">SQL</span> 查询，来查找与之前（昨天的）日期相比温度更高的所有日期的 id 。</span><br><span class="line"></span><br><span class="line">返回结果 不要求顺序 。</span><br><span class="line"></span><br><span class="line">查询结果格式如下例。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 <span class="number">1</span>：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Weather 表：</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> recordDate <span class="operator">|</span> Temperature <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> <span class="number">2015</span><span class="number">-01</span><span class="number">-01</span> <span class="operator">|</span> <span class="number">10</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> <span class="number">2015</span><span class="number">-01</span><span class="number">-02</span> <span class="operator">|</span> <span class="number">25</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>  <span class="operator">|</span> <span class="number">2015</span><span class="number">-01</span><span class="number">-03</span> <span class="operator">|</span> <span class="number">20</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>  <span class="operator">|</span> <span class="number">2015</span><span class="number">-01</span><span class="number">-04</span> <span class="operator">|</span> <span class="number">30</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------------+-------------+</span></span><br><span class="line">输出：</span><br><span class="line"><span class="operator">+</span><span class="comment">----+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+</span></span><br><span class="line">解释：</span><br><span class="line"><span class="number">2015</span><span class="number">-01</span><span class="number">-02</span> 的温度比前一天高（<span class="number">10</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="number">25</span>）</span><br><span class="line"><span class="number">2015</span><span class="number">-01</span><span class="number">-04</span> 的温度比前一天高（<span class="number">20</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="number">30</span>）</span><br></pre></td></tr></table></figure>
<p><strong>解法：交叉连接+Datediff（）函数</strong><br><strong>思路：</strong></p>
<ol>
<li>与之前的日期相差为 1</li>
<li>比之前的温度高</li>
<li>datediff函数可以计算两个日期的日期差</li>
<li>交叉联结会将两表中所有的记录两两结合，只有这样才可以结合出两个日期在一条记录中</li>
</ol>
<p><strong>代码如下</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> w1.id </span><br><span class="line"><span class="keyword">from</span> Weather w1,Weather w2</span><br><span class="line"><span class="keyword">where</span> datediff(w1.RecordDate,w2.RecordDate) <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> w1.Temperature<span class="operator">&gt;</span>w2.Temperature;</span><br></pre></td></tr></table></figure>
<h2 id="1661-每台机器的进程平均运行时间"><a href="#1661-每台机器的进程平均运行时间" class="headerlink" title="1661. 每台机器的进程平均运行时间"></a>1661. 每台机器的进程平均运行时间</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">表: Activity</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name    <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line"><span class="operator">|</span> machine_id     <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> process_id     <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> activity_type  <span class="operator">|</span> enum    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="type">timestamp</span>      <span class="operator">|</span> <span class="type">float</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------+</span></span><br><span class="line">该表展示了一家工厂网站的用户活动.</span><br><span class="line">(machine_id, process_id, activity_type) 是当前表的主键.</span><br><span class="line">machine_id 是一台机器的ID号.</span><br><span class="line">process_id 是运行在各机器上的进程ID号.</span><br><span class="line">activity_type 是枚举类型 (<span class="string">&#x27;start&#x27;</span>, <span class="string">&#x27;end&#x27;</span>).</span><br><span class="line"><span class="type">timestamp</span> 是浮点类型,代表当前时间(以秒为单位).</span><br><span class="line"><span class="string">&#x27;start&#x27;</span> 代表该进程在这台机器上的开始运行时间戳 , <span class="string">&#x27;end&#x27;</span> 代表该进程在这台机器上的终止运行时间戳.</span><br><span class="line">同一台机器，同一个进程都有一对开始时间戳和结束时间戳，而且开始时间戳永远在结束时间戳前面.</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">现在有一个工厂网站由几台机器运行，每台机器上运行着相同数量的进程. 请写出一条<span class="keyword">SQL</span>计算每台机器各自完成一个进程任务的平均耗时.</span><br><span class="line"></span><br><span class="line">完成一个进程任务的时间指进程的<span class="string">&#x27;end&#x27;</span> 时间戳 减去 <span class="string">&#x27;start&#x27;</span> 时间戳. 平均耗时通过计算每台机器上所有进程任务的总耗费时间除以机器上的总进程数量获得.</span><br><span class="line"></span><br><span class="line">结果表必须包含machine_id（机器ID） 和对应的 average <span class="type">time</span>（平均耗时） 别名 processing_time, 且四舍五入保留<span class="number">3</span>位小数.</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回表。</span><br><span class="line"></span><br><span class="line">具体参考例子如下。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Activity <span class="keyword">table</span>:</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+------------+---------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> machine_id <span class="operator">|</span> process_id <span class="operator">|</span> activity_type <span class="operator">|</span> <span class="type">timestamp</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+------------+---------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">0</span>          <span class="operator">|</span> <span class="number">0</span>          <span class="operator">|</span> <span class="keyword">start</span>         <span class="operator">|</span> <span class="number">0.712</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">0</span>          <span class="operator">|</span> <span class="number">0</span>          <span class="operator">|</span> <span class="keyword">end</span>           <span class="operator">|</span> <span class="number">1.520</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">0</span>          <span class="operator">|</span> <span class="number">1</span>          <span class="operator">|</span> <span class="keyword">start</span>         <span class="operator">|</span> <span class="number">3.140</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">0</span>          <span class="operator">|</span> <span class="number">1</span>          <span class="operator">|</span> <span class="keyword">end</span>           <span class="operator">|</span> <span class="number">4.120</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>          <span class="operator">|</span> <span class="number">0</span>          <span class="operator">|</span> <span class="keyword">start</span>         <span class="operator">|</span> <span class="number">0.550</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>          <span class="operator">|</span> <span class="number">0</span>          <span class="operator">|</span> <span class="keyword">end</span>           <span class="operator">|</span> <span class="number">1.550</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>          <span class="operator">|</span> <span class="number">1</span>          <span class="operator">|</span> <span class="keyword">start</span>         <span class="operator">|</span> <span class="number">0.430</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>          <span class="operator">|</span> <span class="number">1</span>          <span class="operator">|</span> <span class="keyword">end</span>           <span class="operator">|</span> <span class="number">1.420</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>          <span class="operator">|</span> <span class="number">0</span>          <span class="operator">|</span> <span class="keyword">start</span>         <span class="operator">|</span> <span class="number">4.100</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>          <span class="operator">|</span> <span class="number">0</span>          <span class="operator">|</span> <span class="keyword">end</span>           <span class="operator">|</span> <span class="number">4.512</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>          <span class="operator">|</span> <span class="number">1</span>          <span class="operator">|</span> <span class="keyword">start</span>         <span class="operator">|</span> <span class="number">2.500</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>          <span class="operator">|</span> <span class="number">1</span>          <span class="operator">|</span> <span class="keyword">end</span>           <span class="operator">|</span> <span class="number">5.000</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+------------+---------------+-----------+</span></span><br><span class="line">输出：</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> machine_id <span class="operator">|</span> processing_time <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">0</span>          <span class="operator">|</span> <span class="number">0.894</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>          <span class="operator">|</span> <span class="number">0.995</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>          <span class="operator">|</span> <span class="number">1.456</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------------+</span></span><br><span class="line">解释：</span><br><span class="line">一共有<span class="number">3</span>台机器,每台机器运行着两个进程.</span><br><span class="line">机器 <span class="number">0</span> 的平均耗时: ((<span class="number">1.520</span> <span class="operator">-</span> <span class="number">0.712</span>) <span class="operator">+</span> (<span class="number">4.120</span> <span class="operator">-</span> <span class="number">3.140</span>)) <span class="operator">/</span> <span class="number">2</span> <span class="operator">=</span> <span class="number">0.894</span></span><br><span class="line">机器 <span class="number">1</span> 的平均耗时: ((<span class="number">1.550</span> <span class="operator">-</span> <span class="number">0.550</span>) <span class="operator">+</span> (<span class="number">1.420</span> <span class="operator">-</span> <span class="number">0.430</span>)) <span class="operator">/</span> <span class="number">2</span> <span class="operator">=</span> <span class="number">0.995</span></span><br><span class="line">机器 <span class="number">2</span> 的平均耗时: ((<span class="number">4.512</span> <span class="operator">-</span> <span class="number">4.100</span>) <span class="operator">+</span> (<span class="number">5.000</span> <span class="operator">-</span> <span class="number">2.500</span>)) <span class="operator">/</span> <span class="number">2</span> <span class="operator">=</span> <span class="number">1.456</span></span><br></pre></td></tr></table></figure>
<p><strong>解法：利用round函数+avg函数+if函数</strong><br>round函数用户四舍五入<br>avg函数用于求平均值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    machine_id,</span><br><span class="line">    round(<span class="built_in">avg</span>(if(activity_type<span class="operator">=</span><span class="string">&#x27;start&#x27;</span>, <span class="operator">-</span><span class="type">timestamp</span>, <span class="type">timestamp</span>))<span class="operator">*</span><span class="number">2</span>, <span class="number">3</span>) processing_time </span><br><span class="line"><span class="keyword">from</span> Activity </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> machine_id</span><br></pre></td></tr></table></figure>
<h2 id="577-员工奖金"><a href="#577-员工奖金" class="headerlink" title="577. 员工奖金"></a>577. 员工奖金</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">选出所有 bonus &lt; <span class="number">1000</span> 的员工的 name 及其 bonus。</span><br><span class="line"></span><br><span class="line">Employee 表单</span><br><span class="line"></span><br><span class="line">+-------+--------+-----------+--------+</span><br><span class="line">| empId |  name  | supervisor| salary |</span><br><span class="line">+-------+--------+-----------+--------+</span><br><span class="line">|   <span class="number">1</span>   | John   |  <span class="number">3</span>        | <span class="number">1000</span>   |</span><br><span class="line">|   <span class="number">2</span>   | Dan    |  <span class="number">3</span>        | <span class="number">2000</span>   |</span><br><span class="line">|   <span class="number">3</span>   | Brad   |  <span class="literal">null</span>     | <span class="number">4000</span>   |</span><br><span class="line">|   <span class="number">4</span>   | Thomas |  <span class="number">3</span>        | <span class="number">4000</span>   |</span><br><span class="line">+-------+--------+-----------+--------+</span><br><span class="line">empId 是这张表单的主关键字</span><br><span class="line">Bonus 表单</span><br><span class="line"></span><br><span class="line">+-------+-------+</span><br><span class="line">| empId | bonus |</span><br><span class="line">+-------+-------+</span><br><span class="line">| <span class="number">2</span>     | <span class="number">500</span>   |</span><br><span class="line">| <span class="number">4</span>     | <span class="number">2000</span>  |</span><br><span class="line">+-------+-------+</span><br><span class="line">empId 是这张表单的主关键字</span><br><span class="line">输出示例：</span><br><span class="line"></span><br><span class="line">+-------+-------+</span><br><span class="line">| name  | bonus |</span><br><span class="line">+-------+-------+</span><br><span class="line">| John  | <span class="literal">null</span>  |</span><br><span class="line">| Dan   | <span class="number">500</span>   |</span><br><span class="line">| Brad  | <span class="literal">null</span>  |</span><br><span class="line">+-------+-------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：外连接</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.name,b.bonus</span><br><span class="line"><span class="keyword">from</span> employee e <span class="keyword">left</span> <span class="keyword">join</span> bonus b</span><br><span class="line"><span class="keyword">on</span> e.empId<span class="operator">=</span>b.empId</span><br><span class="line"><span class="keyword">where</span> bonus<span class="operator">&lt;</span><span class="number">1000</span> <span class="keyword">or</span> bonus <span class="keyword">is</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>
<h2 id="1280-学生们参加各科测试的次数"><a href="#1280-学生们参加各科测试的次数" class="headerlink" title="1280. 学生们参加各科测试的次数"></a>1280. 学生们参加各科测试的次数</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">学生表: Students</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| student_id    | <span class="type">int</span>     |</span><br><span class="line">| student_name  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">主键为 student_id（学生ID），该表内的每一行都记录有学校一名学生的信息。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">科目表: Subjects</span><br><span class="line"></span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| subject_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">主键为 subject_name（科目名称），每一行记录学校的一门科目名称。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">考试表: Examinations</span><br><span class="line"></span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| student_id   | <span class="type">int</span>     |</span><br><span class="line">| subject_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">这张表压根没有主键，可能会有重复行。</span><br><span class="line">学生表里的一个学生修读科目表里的每一门科目，而这张考试表的每一行记录就表示学生表里的某个学生参加了一次科目表里某门科目的测试。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">要求写一段 SQL 语句，查询出每个学生参加每一门科目测试的次数，结果按 student_id 和 subject_name 排序。</span><br><span class="line"></span><br><span class="line">查询结构格式如下所示：</span><br><span class="line"></span><br><span class="line">Students table:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| student_id | student_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| <span class="number">1</span>          | Alice        |</span><br><span class="line">| <span class="number">2</span>          | Bob          |</span><br><span class="line">| <span class="number">13</span>         | John         |</span><br><span class="line">| <span class="number">6</span>          | Alex         |</span><br><span class="line">+------------+--------------+</span><br><span class="line">Subjects table:</span><br><span class="line">+--------------+</span><br><span class="line">| subject_name |</span><br><span class="line">+--------------+</span><br><span class="line">| Math         |</span><br><span class="line">| Physics      |</span><br><span class="line">| Programming  |</span><br><span class="line">+--------------+</span><br><span class="line">Examinations table:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| student_id | subject_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| <span class="number">1</span>          | Math         |</span><br><span class="line">| <span class="number">1</span>          | Physics      |</span><br><span class="line">| <span class="number">1</span>          | Programming  |</span><br><span class="line">| <span class="number">2</span>          | Programming  |</span><br><span class="line">| <span class="number">1</span>          | Physics      |</span><br><span class="line">| <span class="number">1</span>          | Math         |</span><br><span class="line">| <span class="number">13</span>         | Math         |</span><br><span class="line">| <span class="number">13</span>         | Programming  |</span><br><span class="line">| <span class="number">13</span>         | Physics      |</span><br><span class="line">| <span class="number">2</span>          | Math         |</span><br><span class="line">| <span class="number">1</span>          | Math         |</span><br><span class="line">+------------+--------------+</span><br><span class="line">Result table:</span><br><span class="line">+------------+--------------+--------------+----------------+</span><br><span class="line">| student_id | student_name | subject_name | attended_exams |</span><br><span class="line">+------------+--------------+--------------+----------------+</span><br><span class="line">| <span class="number">1</span>          | Alice        | Math         | <span class="number">3</span>              |</span><br><span class="line">| <span class="number">1</span>          | Alice        | Physics      | <span class="number">2</span>              |</span><br><span class="line">| <span class="number">1</span>          | Alice        | Programming  | <span class="number">1</span>              |</span><br><span class="line">| <span class="number">2</span>          | Bob          | Math         | <span class="number">1</span>              |</span><br><span class="line">| <span class="number">2</span>          | Bob          | Physics      | <span class="number">0</span>              |</span><br><span class="line">| <span class="number">2</span>          | Bob          | Programming  | <span class="number">1</span>              |</span><br><span class="line">| <span class="number">6</span>          | Alex         | Math         | <span class="number">0</span>              |</span><br><span class="line">| <span class="number">6</span>          | Alex         | Physics      | <span class="number">0</span>              |</span><br><span class="line">| <span class="number">6</span>          | Alex         | Programming  | <span class="number">0</span>              |</span><br><span class="line">| <span class="number">13</span>         | John         | Math         | <span class="number">1</span>              |</span><br><span class="line">| <span class="number">13</span>         | John         | Physics      | <span class="number">1</span>              |</span><br><span class="line">| <span class="number">13</span>         | John         | Programming  | <span class="number">1</span>              |</span><br><span class="line">+------------+--------------+--------------+----------------+</span><br></pre></td></tr></table></figure>
<p><strong>题解：交叉连接+外连接</strong><br><strong>解题思路：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">首先，先得看最后的表格要求是什么样的。我们观察发现，表格前几列是每个学生都有对应的科目记录行</span><br><span class="line">，不管是否参加，所以要把学生表和科目表进行cross join保证每个学生后面都有每个科目的记录；</span><br><span class="line"></span><br><span class="line">然后发现，最后一列是求的每个学生，每个科目的参考次数。<span class="number">2</span>个每个，所以groupby 学生，科目；</span><br><span class="line"></span><br><span class="line">注意我们应该以第一个cross join的表为主表因为有的学生可能没参加某个科目的考试。 所以</span><br><span class="line">我们left join 到exam表格。</span><br><span class="line"></span><br><span class="line">最后将两个表合并，重新取数分组，就可以得到结果啦。</span><br><span class="line"></span><br><span class="line">我觉得这个思路比最高赞的好理解。下面是详细解析</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">ss.student_id <span class="keyword">as</span> student_id,</span><br><span class="line">ss.student_name <span class="keyword">as</span> student_name,</span><br><span class="line">ss.subject_name <span class="keyword">as</span> subject_name,</span><br><span class="line">ifnull(e1.attended_exams, <span class="number">0</span>) <span class="keyword">as</span> attended_exams</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">  <span class="keyword">select</span></span><br><span class="line">  <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> `Students` <span class="keyword">as</span> s1 </span><br><span class="line">  <span class="keyword">cross</span> <span class="keyword">join</span> `Subjects` <span class="keyword">as</span> s2</span><br><span class="line">) <span class="keyword">as</span> ss</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span></span><br><span class="line">(</span><br><span class="line">  <span class="keyword">select</span></span><br><span class="line">  student_id, </span><br><span class="line">  subject_name,</span><br><span class="line">  <span class="built_in">count</span>(student_id) <span class="keyword">as</span> attended_exams</span><br><span class="line">  <span class="keyword">from</span> `Examinations`</span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> student_id,subject_name</span><br><span class="line">) <span class="keyword">as</span> e1</span><br><span class="line"><span class="keyword">on</span> ss.student_id <span class="operator">=</span> e1.student_id</span><br><span class="line"><span class="keyword">and</span> ss.subject_name <span class="operator">=</span> e1.subject_name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> ss.student_id, ss.subject_name</span><br></pre></td></tr></table></figure>
<h2 id="570-至少有5名直接下属的经理"><a href="#570-至少有5名直接下属的经理" class="headerlink" title="570. 至少有5名直接下属的经理"></a>570. 至少有5名直接下属的经理</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">表: Employee</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| id          | <span class="type">int</span>     |</span><br><span class="line">| name        | varchar |</span><br><span class="line">| department  | varchar |</span><br><span class="line">| managerId   | <span class="type">int</span>     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">Id是该表的主键列。</span><br><span class="line">该表的每一行都表示雇员的名字、他们的部门和他们的经理的id。</span><br><span class="line">如果managerId为空，则该员工没有经理。</span><br><span class="line">没有员工会成为自己的管理者。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写一个SQL查询，查询至少有<span class="number">5</span>名直接下属的经理 。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式如下所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">输入: </span><br><span class="line">Employee 表:</span><br><span class="line">+-----+-------+------------+-----------+</span><br><span class="line">| id  | name  | department | managerId |</span><br><span class="line">+-----+-------+------------+-----------+</span><br><span class="line">| <span class="number">101</span> | John  | A          | None      |</span><br><span class="line">| <span class="number">102</span> | Dan   | A          | <span class="number">101</span>       |</span><br><span class="line">| <span class="number">103</span> | James | A          | <span class="number">101</span>       |</span><br><span class="line">| <span class="number">104</span> | Amy   | A          | <span class="number">101</span>       |</span><br><span class="line">| <span class="number">105</span> | Anne  | A          | <span class="number">101</span>       |</span><br><span class="line">| <span class="number">106</span> | Ron   | B          | <span class="number">101</span>       |</span><br><span class="line">+-----+-------+------------+-----------+</span><br><span class="line">输出: </span><br><span class="line">+------+</span><br><span class="line">| name |</span><br><span class="line">+------+</span><br><span class="line">| John |</span><br><span class="line">+------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：使用临时表进行连接</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> b.name</span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> managerId</span><br><span class="line">      <span class="keyword">from</span> Employee</span><br><span class="line">      <span class="keyword">group</span> <span class="keyword">by</span> managerId</span><br><span class="line">      <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;=</span><span class="number">5</span>) a <span class="keyword">join</span> Employee b</span><br><span class="line"><span class="keyword">on</span> a.managerId <span class="operator">=</span> b.id</span><br></pre></td></tr></table></figure>
<p>注意：过滤组用having函数</p>
<h2 id="1934-确认率"><a href="#1934-确认率" class="headerlink" title="1934. 确认率"></a>1934. 确认率</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">表: Signups</span><br><span class="line"></span><br><span class="line">+----------------+----------+</span><br><span class="line">| Column Name    | Type     |</span><br><span class="line">+----------------+----------+</span><br><span class="line">| user_id        | <span class="type">int</span>      |</span><br><span class="line">| time_stamp     | datetime |</span><br><span class="line">+----------------+----------+</span><br><span class="line">User_id是该表的主键。</span><br><span class="line">每一行都包含ID为user_id的用户的注册时间信息。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">表: Confirmations</span><br><span class="line"></span><br><span class="line">+----------------+----------+</span><br><span class="line">| Column Name    | Type     |</span><br><span class="line">+----------------+----------+</span><br><span class="line">| user_id        | <span class="type">int</span>      |</span><br><span class="line">| time_stamp     | datetime |</span><br><span class="line">| action         | ENUM     |</span><br><span class="line">+----------------+----------+</span><br><span class="line">(user_id, time_stamp)是该表的主键。</span><br><span class="line">user_id是一个引用到注册表的外键。</span><br><span class="line">action是类型为(<span class="string">&#x27;confirmed&#x27;</span>， <span class="string">&#x27;timeout&#x27;</span>)的ENUM</span><br><span class="line">该表的每一行都表示ID为user_id的用户在time_stamp请求了一条确认消息，该确认消息要么被确认(<span class="string">&#x27;confirmed&#x27;</span>)，要么被过期(<span class="string">&#x27;timeout&#x27;</span>)。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">用户的 确认率 是 <span class="string">&#x27;confirmed&#x27;</span> 消息的数量除以请求的确认消息的总数。没有请求任何确认消息的用户的确认率为 <span class="number">0</span> 。确认率四舍五入到 小数点后两位 。</span><br><span class="line"></span><br><span class="line">编写一个SQL查询来查找每个用户的 确认率 。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式如下所示。</span><br><span class="line"></span><br><span class="line">示例<span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Signups 表:</span><br><span class="line">+---------+---------------------+</span><br><span class="line">| user_id | time_stamp          |</span><br><span class="line">+---------+---------------------+</span><br><span class="line">| <span class="number">3</span>       | <span class="number">2020</span>-<span class="number">03</span>-<span class="number">21</span> <span class="number">10</span>:<span class="number">16</span>:<span class="number">13</span> |</span><br><span class="line">| <span class="number">7</span>       | <span class="number">2020</span>-<span class="number">01</span>-<span class="number">04</span> <span class="number">13</span>:<span class="number">57</span>:<span class="number">59</span> |</span><br><span class="line">| <span class="number">2</span>       | <span class="number">2020</span>-<span class="number">07</span>-<span class="number">29</span> <span class="number">23</span>:09:<span class="number">44</span> |</span><br><span class="line">| <span class="number">6</span>       | <span class="number">2020</span>-<span class="number">12</span>-09 <span class="number">10</span>:<span class="number">39</span>:<span class="number">37</span> |</span><br><span class="line">+---------+---------------------+</span><br><span class="line">Confirmations 表:</span><br><span class="line">+---------+---------------------+-----------+</span><br><span class="line">| user_id | time_stamp          | action    |</span><br><span class="line">+---------+---------------------+-----------+</span><br><span class="line">| <span class="number">3</span>       | <span class="number">2021</span>-<span class="number">01</span>-<span class="number">06</span> <span class="number">03</span>:<span class="number">30</span>:<span class="number">46</span> | timeout   |</span><br><span class="line">| <span class="number">3</span>       | <span class="number">2021</span>-<span class="number">07</span>-<span class="number">14</span> <span class="number">14</span>:<span class="number">00</span>:<span class="number">00</span> | timeout   |</span><br><span class="line">| <span class="number">7</span>       | <span class="number">2021</span>-<span class="number">06</span>-<span class="number">12</span> <span class="number">11</span>:<span class="number">57</span>:<span class="number">29</span> | confirmed |</span><br><span class="line">| <span class="number">7</span>       | <span class="number">2021</span>-<span class="number">06</span>-<span class="number">13</span> <span class="number">12</span>:<span class="number">58</span>:<span class="number">28</span> | confirmed |</span><br><span class="line">| <span class="number">7</span>       | <span class="number">2021</span>-<span class="number">06</span>-<span class="number">14</span> <span class="number">13</span>:<span class="number">59</span>:<span class="number">27</span> | confirmed |</span><br><span class="line">| <span class="number">2</span>       | <span class="number">2021</span>-<span class="number">01</span>-<span class="number">22</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> | confirmed |</span><br><span class="line">| <span class="number">2</span>       | <span class="number">2021</span>-<span class="number">02</span>-<span class="number">28</span> <span class="number">23</span>:<span class="number">59</span>:<span class="number">59</span> | timeout   |</span><br><span class="line">+---------+---------------------+-----------+</span><br><span class="line">输出: </span><br><span class="line">+---------+-------------------+</span><br><span class="line">| user_id | confirmation_rate |</span><br><span class="line">+---------+-------------------+</span><br><span class="line">| <span class="number">6</span>       | <span class="number">0.00</span>              |</span><br><span class="line">| <span class="number">3</span>       | <span class="number">0.00</span>              |</span><br><span class="line">| <span class="number">7</span>       | <span class="number">1.00</span>              |</span><br><span class="line">| <span class="number">2</span>       | <span class="number">0.50</span>              |</span><br><span class="line">+---------+-------------------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：外连接+分组+函数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.user_id,ifnull( ,<span class="number">0</span>) <span class="keyword">as</span> confirmation_rate</span><br><span class="line"><span class="keyword">from</span> Signups s <span class="keyword">left</span> <span class="keyword">join</span> Confirmations c</span><br><span class="line"><span class="keyword">on</span> s.user_id<span class="operator">=</span>c.user_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> user_id</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    s.user_id,round(<span class="built_in">sum</span>(if(action<span class="operator">=</span><span class="string">&#x27;confirmed&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>))<span class="operator">/</span><span class="built_in">count</span>(s.user_id),<span class="number">2</span>) <span class="keyword">as</span> confirmation_rate</span><br><span class="line"><span class="keyword">from</span> Signups s</span><br><span class="line">    <span class="keyword">left</span> <span class="keyword">join</span> Confirmations c <span class="keyword">on</span> s.user_id <span class="operator">=</span> c.user_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> s.user_id;</span><br></pre></td></tr></table></figure>
<h1 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h1><h2 id="620-有趣的电影"><a href="#620-有趣的电影" class="headerlink" title="620. 有趣的电影"></a>620. 有趣的电影</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">某城市开了一家新的电影院，吸引了很多人过来看电影。该电影院特别注意用户体验，专门有个 LED显示板做电影推荐，上面公布着影评和相关电影描述。</span><br><span class="line"></span><br><span class="line">作为该电影院的信息部主管，您需要编写一个 SQL查询，找出所有影片描述为非 boring (不无聊) 的并且 id 为奇数 的影片，结果请按等级 rating 排列。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">例如，下表 cinema:</span><br><span class="line"></span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   id    | movie     |  description |  rating   |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   1     | War       |   great 3D   |   8.9     |</span><br><span class="line">|   2     | Science   |   fiction    |   8.5     |</span><br><span class="line">|   3     | irish     |   boring     |   6.2     |</span><br><span class="line">|   4     | Ice song  |   Fantacy    |   8.6     |</span><br><span class="line">|   5     | House card|   Interesting|   9.1     |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">对于上面的例子，则正确的输出是为：</span><br><span class="line"></span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   id    | movie     |  description |  rating   |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   5     | House card|   Interesting|   9.1     |</span><br><span class="line">|   1     | War       |   great 3D   |   8.9     |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br></pre></td></tr></table></figure>
<p><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span> cinema</span><br><span class="line"><span class="keyword">where</span> description<span class="operator">!=</span><span class="string">&#x27;boring&#x27;</span> <span class="keyword">and</span> id<span class="operator">%</span><span class="number">2</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> rating <span class="keyword">desc</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>也可以使用mod函数，mod函数就是取余函数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> cinema</span><br><span class="line"><span class="keyword">where</span> <span class="built_in">mod</span>(id, <span class="number">2</span>) <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> description <span class="operator">!=</span> <span class="string">&#x27;boring&#x27;</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> rating <span class="keyword">DESC</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<h2 id="1251-平均售价"><a href="#1251-平均售价" class="headerlink" title="1251. 平均售价"></a><strong>1251. 平均售价</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">Table: Prices</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| start_date    | date    |</span><br><span class="line">| end_date      | date    |</span><br><span class="line">| price         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(product_id，start_date，end_date) 是 Prices 表的主键。</span><br><span class="line">Prices 表的每一行表示的是某个产品在一段时期内的价格。</span><br><span class="line">每个产品的对应时间段是不会重叠的，这也意味着同一个产品的价格时段不会出现交叉。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Table: UnitsSold</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| purchase_date | date    |</span><br><span class="line">| units         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">UnitsSold 表没有主键，它可能包含重复项。</span><br><span class="line">UnitsSold 表的每一行表示的是每种产品的出售日期，单位和产品 id。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写SQL查询以查找每种产品的平均售价。</span><br><span class="line">average_price 应该四舍五入到小数点后两位。</span><br><span class="line">查询结果格式如下例所示：</span><br><span class="line"></span><br><span class="line">Prices table:</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line">| product_id | start_date | end_date   | price  |</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line">| 1          | 2019-02-17 | 2019-02-28 | 5      |</span><br><span class="line">| 1          | 2019-03-01 | 2019-03-22 | 20     |</span><br><span class="line">| 2          | 2019-02-01 | 2019-02-20 | 15     |</span><br><span class="line">| 2          | 2019-02-21 | 2019-03-31 | 30     |</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line"> </span><br><span class="line">UnitsSold table:</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line">| product_id | purchase_date | units |</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line">| 1          | 2019-02-25    | 100   |</span><br><span class="line">| 1          | 2019-03-01    | 15    |</span><br><span class="line">| 2          | 2019-02-10    | 200   |</span><br><span class="line">| 2          | 2019-03-22    | 30    |</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+---------------+</span><br><span class="line">| product_id | average_price |</span><br><span class="line">+------------+---------------+</span><br><span class="line">| 1          | 6.96          |</span><br><span class="line">| 2          | 16.96         |</span><br><span class="line">+------------+---------------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：sum函数+分组+round函数+join联表</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> p.product_id,round(<span class="built_in">sum</span>(p.price<span class="operator">*</span>u.units)<span class="operator">/</span><span class="built_in">sum</span>(units),<span class="number">2</span>) <span class="keyword">as</span> average_price</span><br><span class="line"><span class="keyword">from</span> Prices p <span class="keyword">join</span> UnitsSold u </span><br><span class="line"><span class="keyword">on</span> p.product_id <span class="operator">=</span> u.product_id <span class="keyword">and</span> u.purchase_date <span class="operator">&gt;=</span> p.start_date <span class="keyword">and</span> u.purchase_date <span class="operator">&lt;=</span>p.end_date</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> p.product_id</span><br></pre></td></tr></table></figure>
<h2 id="1075-项目员工-I"><a href="#1075-项目员工-I" class="headerlink" title="1075. 项目员工 I"></a><strong>1075. 项目员工 I</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">项目表 Project： </span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| project_id  | int     |</span><br><span class="line">| employee_id | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">主键为 (project_id, employee_id)。</span><br><span class="line">employee_id 是员工表 Employee 表的外键。</span><br><span class="line">员工表 Employee：</span><br><span class="line"></span><br><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| employee_id      | int     |</span><br><span class="line">| name             | varchar |</span><br><span class="line">| experience_years | int     |</span><br><span class="line">+------------------+---------+</span><br><span class="line">主键是 employee_id。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">请写一个 SQL 语句，查询每一个项目中员工的 平均 工作年限，精确到小数点后两位。</span><br><span class="line"></span><br><span class="line">查询结果的格式如下：</span><br><span class="line"></span><br><span class="line">Project 表：</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| project_id  | employee_id |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 1           |</span><br><span class="line">| 1           | 2           |</span><br><span class="line">| 1           | 3           |</span><br><span class="line">| 2           | 1           |</span><br><span class="line">| 2           | 4           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Employee 表：</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| employee_id | name   | experience_years |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| 1           | Khaled | 3                |</span><br><span class="line">| 2           | Ali    | 2                |</span><br><span class="line">| 3           | John   | 1                |</span><br><span class="line">| 4           | Doe    | 2                |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line"></span><br><span class="line">Result 表：</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| project_id  | average_years |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | 2.00          |</span><br><span class="line">| 2           | 2.50          |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">第一个项目中，员工的平均工作年限是 (3 + 2 + 1) / 3 = 2.00；</span><br><span class="line">第二个项目中，员工的平均工作年限是 (3 + 2) / 2 = 2.50</span><br></pre></td></tr></table></figure>
<p><strong>解法：group by+round+avg函数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> p.project_id,round(<span class="built_in">avg</span>(e.experience_years),<span class="number">2</span>) <span class="keyword">as</span> average_years</span><br><span class="line"><span class="keyword">from</span> Project p <span class="keyword">join</span> Employee e </span><br><span class="line"><span class="keyword">on</span> p.employee_id <span class="operator">=</span> e.employee_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> p.project_id</span><br></pre></td></tr></table></figure>


<h2 id="1633-各赛事的用户注册率"><a href="#1633-各赛事的用户注册率" class="headerlink" title="1633. 各赛事的用户注册率"></a><strong>1633. 各赛事的用户注册率</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">用户表： Users</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| user_id     | int     |</span><br><span class="line">| user_name   | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">user_id 是该表的主键。</span><br><span class="line">该表中的每行包括用户 ID 和用户名。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">注册表： Register</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| contest_id  | int     |</span><br><span class="line">| user_id     | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">(contest_id, user_id) 是该表的主键。</span><br><span class="line">该表中的每行包含用户的 ID 和他们注册的赛事。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">写一条 SQL 语句，查询各赛事的用户注册百分率，保留两位小数。</span><br><span class="line"></span><br><span class="line">返回的结果表按 percentage 的 降序 排序，若相同则按 contest_id 的 升序 排序。</span><br><span class="line"></span><br><span class="line">查询结果如下示例所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Users 表：</span><br><span class="line">+---------+-----------+</span><br><span class="line">| user_id | user_name |</span><br><span class="line">+---------+-----------+</span><br><span class="line">| 6       | Alice     |</span><br><span class="line">| 2       | Bob       |</span><br><span class="line">| 7       | Alex      |</span><br><span class="line">+---------+-----------+</span><br><span class="line"></span><br><span class="line">Register 表：</span><br><span class="line">+------------+---------+</span><br><span class="line">| contest_id | user_id |</span><br><span class="line">+------------+---------+</span><br><span class="line">| 215        | 6       |</span><br><span class="line">| 209        | 2       |</span><br><span class="line">| 208        | 2       |</span><br><span class="line">| 210        | 6       |</span><br><span class="line">| 208        | 6       |</span><br><span class="line">| 209        | 7       |</span><br><span class="line">| 209        | 6       |</span><br><span class="line">| 215        | 7       |</span><br><span class="line">| 208        | 7       |</span><br><span class="line">| 210        | 2       |</span><br><span class="line">| 207        | 2       |</span><br><span class="line">| 210        | 7       |</span><br><span class="line">+------------+---------+</span><br><span class="line">输出：</span><br><span class="line">+------------+------------+</span><br><span class="line">| contest_id | percentage |</span><br><span class="line">+------------+------------+</span><br><span class="line">| 208        | 100.0      |</span><br><span class="line">| 209        | 100.0      |</span><br><span class="line">| 210        | 100.0      |</span><br><span class="line">| 215        | 66.67      |</span><br><span class="line">| 207        | 33.33      |</span><br><span class="line">+------------+------------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：子查询</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> contest_id,round(<span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">*</span><span class="number">100</span><span class="operator">/</span>(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> Users),<span class="number">2</span>) <span class="keyword">as</span> percentage</span><br><span class="line"><span class="keyword">from</span> Register</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> contest_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> percentage <span class="keyword">desc</span>,contest_id <span class="keyword">asc</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span> r.contest_id ,round((<span class="built_in">count</span>(r.user_id)<span class="operator">/</span>n.nums)<span class="operator">*</span><span class="number">100</span>,<span class="number">2</span>) <span class="keyword">as</span> percentage </span><br><span class="line"><span class="keyword">from</span> Register r <span class="keyword">join</span> (</span><br><span class="line">  <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> nums</span><br><span class="line">  <span class="keyword">from</span> Users</span><br><span class="line">) n</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> contest_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> percentage <span class="keyword">desc</span> ,r.contest_id <span class="keyword">asc</span></span><br></pre></td></tr></table></figure>
<h2 id="1211-查询结果的质量和占比"><a href="#1211-查询结果的质量和占比" class="headerlink" title="1211. 查询结果的质量和占比"></a><strong>1211. 查询结果的质量和占比</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">查询表 Queries： </span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| query_name  | varchar |</span><br><span class="line">| result      | varchar |</span><br><span class="line">| position    | int     |</span><br><span class="line">| rating      | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">此表没有主键，并可能有重复的行。</span><br><span class="line">此表包含了一些从数据库中收集的查询信息。</span><br><span class="line">“位置”（position）列的值为 1 到 500 。</span><br><span class="line">“评分”（rating）列的值为 1 到 5 。评分小于 3 的查询被定义为质量很差的查询。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">将查询结果的质量 quality 定义为：</span><br><span class="line"></span><br><span class="line">各查询结果的评分与其位置之间比率的平均值。</span><br><span class="line"></span><br><span class="line">将劣质查询百分比 poor_query_percentage 为：</span><br><span class="line"></span><br><span class="line">评分小于 3 的查询结果占全部查询结果的百分比。</span><br><span class="line"></span><br><span class="line">编写一组 SQL 来查找每次查询的名称(query_name)、质量(quality) 和 劣质查询百分比(poor_query_percentage)。</span><br><span class="line"></span><br><span class="line">质量(quality) 和劣质查询百分比(poor_query_percentage) 都应四舍五入到小数点后两位。</span><br><span class="line"></span><br><span class="line">查询结果格式如下所示：</span><br><span class="line"></span><br><span class="line">Queries table:</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line">| query_name | result            | position | rating |</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line">| Dog        | Golden Retriever  | 1        | 5      |</span><br><span class="line">| Dog        | German Shepherd   | 2        | 5      |</span><br><span class="line">| Dog        | Mule              | 200      | 1      |</span><br><span class="line">| Cat        | Shirazi           | 5        | 2      |</span><br><span class="line">| Cat        | Siamese           | 3        | 3      |</span><br><span class="line">| Cat        | Sphynx            | 7        | 4      |</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+---------+-----------------------+</span><br><span class="line">| query_name | quality | poor_query_percentage |</span><br><span class="line">+------------+---------+-----------------------+</span><br><span class="line">| Dog        | 2.50    | 33.33                 |</span><br><span class="line">| Cat        | 0.66    | 33.33                 |</span><br><span class="line">+------------+---------+-----------------------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：聚合函数的使用</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> query_name ,round(<span class="built_in">avg</span>(rating<span class="operator">/</span>position),<span class="number">2</span>) <span class="keyword">as</span> quality,</span><br><span class="line">round(<span class="built_in">sum</span>(if(rating<span class="operator">&lt;</span><span class="number">3</span>,<span class="number">1</span>,<span class="number">0</span>))<span class="operator">*</span><span class="number">100</span><span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>),<span class="number">2</span>) <span class="keyword">as</span> poor_query_percentage </span><br><span class="line"><span class="keyword">from</span> Queries</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> query_name</span><br></pre></td></tr></table></figure>
<p><strong>为什么不能用count(rating&lt;3)&#x2F;count(*)？</strong><br> rating&lt;3 是一个逻辑判断 结果为true or false， true是1 false 是0 ， 用sum可以找出所有的true的和但是用 count 就会算 所有true和false 的个数 应该是和count(<em>)结果一样了<br>改为count(rating&lt;3,null)&#x2F;count(</em>) 就可以了。</p>
<h2 id="1193-每月交易-I"><a href="#1193-每月交易-I" class="headerlink" title="1193. 每月交易 I"></a><strong>1193. 每月交易 I</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Table: Transactions</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| country       | varchar |</span><br><span class="line">| state         | enum    |</span><br><span class="line">| amount        | int     |</span><br><span class="line">| trans_date    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id 是这个表的主键。</span><br><span class="line">该表包含有关传入事务的信息。</span><br><span class="line">state 列类型为 “[”批准“，”拒绝“] 之一。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">编写一个 sql 查询来查找每个月和每个国家/地区的事务数及其总金额、已批准的事务数及其总金额。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式如下所示。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Transactions table:</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| id   | country | state    | amount | trans_date |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">| 121  | US      | approved | 1000   | 2018-12-18 |</span><br><span class="line">| 122  | US      | declined | 2000   | 2018-12-19 |</span><br><span class="line">| 123  | US      | approved | 2000   | 2019-01-01 |</span><br><span class="line">| 124  | DE      | approved | 2000   | 2019-01-07 |</span><br><span class="line">+------+---------+----------+--------+------------+</span><br><span class="line">输出：</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br><span class="line">| month    | country | trans_count | approved_count | trans_total_amount | approved_total_amount |</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br><span class="line">| 2018-12  | US      | 2           | 1              | 3000               | 1000                  |</span><br><span class="line">| 2019-01  | US      | 1           | 1              | 2000               | 2000                  |</span><br><span class="line">| 2019-01  | DE      | 1           | 1              | 2000               | 2000                  |</span><br><span class="line">+----------+---------+-------------+----------------+--------------------+-----------------------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：sum函数+count函数+分组+date_format函数</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(trans_date, <span class="string">&#x27;%Y-%m&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">month</span>,</span><br><span class="line">    country,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> trans_count,</span><br><span class="line">    <span class="built_in">COUNT</span>(IF(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>)) <span class="keyword">AS</span> approved_count,</span><br><span class="line">    <span class="built_in">SUM</span>(amount) <span class="keyword">AS</span> trans_total_amount,</span><br><span class="line">    <span class="built_in">SUM</span>(IF(state <span class="operator">=</span> <span class="string">&#x27;approved&#x27;</span>, amount, <span class="number">0</span>)) <span class="keyword">AS</span> approved_total_amount</span><br><span class="line"><span class="keyword">FROM</span> Transactions</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>, country</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>小结：</strong><br>DATE_FORMAT(date, format)函数用于以不同的格式显示日期&#x2F;时间数据。<br>count(条件）不管记录是否满足条件表达式，只要非NULL就加1。可以这样COUNT(IF(state &#x3D; ‘approved’, 1, NULL))</p>
<h2 id="1174-即时食物配送-II"><a href="#1174-即时食物配送-II" class="headerlink" title="1174. 即时食物配送 II"></a><strong>1174. 即时食物配送 II</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">配送表: Delivery</span><br><span class="line"></span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">| Column Name                 | Type    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">| delivery_id                 | int     |</span><br><span class="line">| customer_id                 | int     |</span><br><span class="line">| order_date                  | date    |</span><br><span class="line">| customer_pref_delivery_date | date    |</span><br><span class="line">+-----------------------------+---------+</span><br><span class="line">delivery_id 是表的主键。</span><br><span class="line">该表保存着顾客的食物配送信息，顾客在某个日期下了订单，并指定了一个期望的配送日期（和下单日期相同或者在那之后）。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">如果顾客期望的配送日期和下单日期相同，则该订单称为 「即时订单」，否则称为「计划订单」。</span><br><span class="line"></span><br><span class="line">「首次订单」是顾客最早创建的订单。我们保证一个顾客只会有一个「首次订单」。</span><br><span class="line"></span><br><span class="line">写一条 SQL 查询语句获取即时订单在所有用户的首次订单中的比例。保留两位小数。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">查询结果如下所示：</span><br><span class="line"></span><br><span class="line">Delivery 表：</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">| delivery_id | customer_id | order_date | customer_pref_delivery_date |</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line">| 1           | 1           | 2019-08-01 | 2019-08-02                  |</span><br><span class="line">| 2           | 2           | 2019-08-02 | 2019-08-02                  |</span><br><span class="line">| 3           | 1           | 2019-08-11 | 2019-08-12                  |</span><br><span class="line">| 4           | 3           | 2019-08-24 | 2019-08-24                  |</span><br><span class="line">| 5           | 3           | 2019-08-21 | 2019-08-22                  |</span><br><span class="line">| 6           | 2           | 2019-08-11 | 2019-08-13                  |</span><br><span class="line">| 7           | 4           | 2019-08-09 | 2019-08-09                  |</span><br><span class="line">+-------------+-------------+------------+-----------------------------+</span><br><span class="line"></span><br><span class="line">Result 表：</span><br><span class="line">+----------------------+</span><br><span class="line">| immediate_percentage |</span><br><span class="line">+----------------------+</span><br><span class="line">| 50.00                |</span><br><span class="line">+----------------------+</span><br><span class="line">1 号顾客的 1 号订单是首次订单，并且是计划订单。</span><br><span class="line">2 号顾客的 2 号订单是首次订单，并且是即时订单。</span><br><span class="line">3 号顾客的 5 号订单是首次订单，并且是计划订单。</span><br><span class="line">4 号顾客的 7 号订单是首次订单，并且是即时订单。</span><br><span class="line">因此，一半顾客的首次订单是即时的。</span><br></pre></td></tr></table></figure>
<p><strong>解法：where子查询</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round(<span class="built_in">count</span>(if(order_date<span class="operator">=</span>customer_pref_delivery_date,<span class="number">1</span>,<span class="keyword">null</span>))<span class="operator">*</span><span class="number">100</span><span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>),<span class="number">2</span>) <span class="keyword">as</span> immediate_percentage</span><br><span class="line"><span class="keyword">from</span> Delivery</span><br><span class="line"><span class="keyword">where</span> (customer_id,order_date) <span class="keyword">in</span> (</span><br><span class="line">  <span class="keyword">select</span> customer_id,<span class="built_in">min</span>(order_date)</span><br><span class="line">  <span class="keyword">from</span> Delivery</span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> customer_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="游戏玩法分析-IV"><a href="#游戏玩法分析-IV" class="headerlink" title="游戏玩法分析 IV"></a><strong>游戏玩法分析 IV</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Table: Activity</span><br><span class="line"></span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">（player_id，event_date）是此表的主键。</span><br><span class="line">这张表显示了某些游戏的玩家的活动情况。</span><br><span class="line">每一行是一个玩家的记录，他在某一天使用某个设备注销之前登录并玩了很多游戏（可能是 0）。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写一个 SQL 查询，报告在首次登录的第二天再次登录的玩家的比率，四舍五入到小数点后两位。换句话说，您需要计算从首次登录日期开始至少连续两天登录的玩家的数量，然后除以玩家总数。</span><br><span class="line"></span><br><span class="line">查询结果格式如下所示：</span><br><span class="line"></span><br><span class="line">Activity table:</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-03-02 | 6            |</span><br><span class="line">| 2         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-02 | 0            |</span><br><span class="line">| 3         | 4         | 2018-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------+</span><br><span class="line">| fraction  |</span><br><span class="line">+-----------+</span><br><span class="line">| 0.33      |</span><br><span class="line">+-----------+</span><br><span class="line">只有 ID 为 1 的玩家在第一天登录后才重新登录，所以答案是 1/3 = 0.33</span><br></pre></td></tr></table></figure>
<p><strong>解法：子查询+外连接</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round(<span class="built_in">count</span>(<span class="keyword">distinct</span> b.player_id)<span class="operator">/</span><span class="built_in">count</span>(<span class="keyword">distinct</span> a.player_id),<span class="number">2</span>) <span class="keyword">as</span> fraction</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">  <span class="keyword">select</span> player_id,<span class="built_in">min</span>(event_date) <span class="keyword">as</span> login</span><br><span class="line">  <span class="keyword">from</span> Activity</span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> player_id</span><br><span class="line">) a <span class="keyword">left</span> <span class="keyword">join</span> Activity b </span><br><span class="line"><span class="keyword">on</span> a.player_id <span class="operator">=</span> b.player_id </span><br><span class="line"><span class="keyword">and</span> datediff(b.event_date,a.login)<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>
<h1 id="排序和分组"><a href="#排序和分组" class="headerlink" title="排序和分组"></a>排序和分组</h1><h2 id="2356-每位教师所教授的科目种类的数量"><a href="#2356-每位教师所教授的科目种类的数量" class="headerlink" title="2356. 每位教师所教授的科目种类的数量"></a>2356. 每位教师所教授的科目种类的数量</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">表: Teacher</span><br><span class="line"></span><br><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| teacher_id  | int  |</span><br><span class="line">| subject_id  | int  |</span><br><span class="line">| dept_id     | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">(subject_id, dept_id) 是该表的主键。</span><br><span class="line">该表中的每一行都表示带有 teacher_id 的教师在系 dept_id 中教授科目 subject_id。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">写一个 SQL 来查询每位老师在大学里教授的科目种类的数量。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式示例如下。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入: </span><br><span class="line">Teacher 表:</span><br><span class="line">+------------+------------+---------+</span><br><span class="line">| teacher_id | subject_id | dept_id |</span><br><span class="line">+------------+------------+---------+</span><br><span class="line">| 1          | 2          | 3       |</span><br><span class="line">| 1          | 2          | 4       |</span><br><span class="line">| 1          | 3          | 3       |</span><br><span class="line">| 2          | 1          | 1       |</span><br><span class="line">| 2          | 2          | 1       |</span><br><span class="line">| 2          | 3          | 1       |</span><br><span class="line">| 2          | 4          | 1       |</span><br><span class="line">+------------+------------+---------+</span><br><span class="line">输出:  </span><br><span class="line">+------------+-----+</span><br><span class="line">| teacher_id | cnt |</span><br><span class="line">+------------+-----+</span><br><span class="line">| 1          | 2   |</span><br><span class="line">| 2          | 4   |</span><br><span class="line">+------------+-----+</span><br></pre></td></tr></table></figure>
<p><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span> teacher_id , <span class="built_in">count</span>(<span class="keyword">distinct</span> subject_id) <span class="keyword">as</span> cnt </span><br><span class="line"><span class="keyword">from</span> Teacher </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> teacher_id</span><br></pre></td></tr></table></figure>
<h2 id="1141-查询近30天活跃用户数"><a href="#1141-查询近30天活跃用户数" class="headerlink" title="1141. 查询近30天活跃用户数"></a><strong>1141. 查询近30天活跃用户数</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">活动记录表：Activity</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| session_id    | int     |</span><br><span class="line">| activity_date | date    |</span><br><span class="line">| activity_type | enum    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">该表是用户在社交网站的活动记录。</span><br><span class="line">该表没有主键，可能包含重复数据。</span><br><span class="line">activity_type 字段为以下四种值 (&#x27;open_session&#x27;, &#x27;end_session&#x27;, &#x27;scroll_down&#x27;, &#x27;send_message&#x27;)。</span><br><span class="line">每个 session_id 只属于一个用户。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">请写SQL查询出截至 2019-07-27（包含2019-07-27），近 30 天的每日活跃用户数（当天只要有一条活动记录，即为活跃用户）。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果示例如下。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Activity table:</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">| user_id | session_id | activity_date | activity_type |</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">| 1       | 1          | 2019-07-20    | open_session  |</span><br><span class="line">| 1       | 1          | 2019-07-20    | scroll_down   |</span><br><span class="line">| 1       | 1          | 2019-07-20    | end_session   |</span><br><span class="line">| 2       | 4          | 2019-07-20    | open_session  |</span><br><span class="line">| 2       | 4          | 2019-07-21    | send_message  |</span><br><span class="line">| 2       | 4          | 2019-07-21    | end_session   |</span><br><span class="line">| 3       | 2          | 2019-07-21    | open_session  |</span><br><span class="line">| 3       | 2          | 2019-07-21    | send_message  |</span><br><span class="line">| 3       | 2          | 2019-07-21    | end_session   |</span><br><span class="line">| 4       | 3          | 2019-06-25    | open_session  |</span><br><span class="line">| 4       | 3          | 2019-06-25    | end_session   |</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">输出：</span><br><span class="line">+------------+--------------+ </span><br><span class="line">| day        | active_users |</span><br><span class="line">+------------+--------------+ </span><br><span class="line">| 2019-07-20 | 2            |</span><br><span class="line">| 2019-07-21 | 2            |</span><br><span class="line">+------------+--------------+ </span><br><span class="line">解释：注意非活跃用户的记录不需要展示。</span><br></pre></td></tr></table></figure>
<p><strong>解法：分组+count(distinct xx)</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span> activity_date <span class="keyword">as</span> <span class="keyword">day</span> ,<span class="built_in">count</span>(<span class="keyword">distinct</span> user_id) <span class="keyword">as</span> active_users </span><br><span class="line"><span class="keyword">from</span> Activity</span><br><span class="line"><span class="keyword">where</span> datediff(<span class="string">&#x27;2019-07-27&#x27;</span>,activity_date)<span class="operator">&lt;</span><span class="number">30</span> <span class="keyword">and</span> activity_date<span class="operator">&lt;</span><span class="string">&#x27;2019-07-27&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> activity_date</span><br></pre></td></tr></table></figure>
<h2 id="1084-销售分析III"><a href="#1084-销售分析III" class="headerlink" title="1084. 销售分析III"></a><strong>1084. 销售分析III</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">Table: Product</span><br><span class="line"></span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">| unit_price   | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">Product_id是该表的主键。</span><br><span class="line">该表的每一行显示每个产品的名称和价格。</span><br><span class="line">Table: Sales</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| seller_id   | int     |</span><br><span class="line">| product_id  | int     |</span><br><span class="line">| buyer_id    | int     |</span><br><span class="line">| sale_date   | date    |</span><br><span class="line">| quantity    | int     |</span><br><span class="line">| price       | int     |</span><br><span class="line">+------ ------+---------+</span><br><span class="line">这个表没有主键，它可以有重复的行。</span><br><span class="line">product_id 是 Product 表的外键。</span><br><span class="line">该表的每一行包含关于一个销售的一些信息。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写一个SQL查询，报告2019年春季才售出的产品。即仅在2019-01-01至2019-03-31（含）之间出售的商品。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式如下所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Product table:</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| product_id | product_name | unit_price |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| 1          | S8           | 1000       |</span><br><span class="line">| 2          | G4           | 800        |</span><br><span class="line">| 3          | iPhone       | 1400       |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">Sales table:</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| seller_id | product_id | buyer_id | sale_date  | quantity | price |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| 1         | 1          | 1        | 2019-01-21 | 2        | 2000  |</span><br><span class="line">| 1         | 2          | 2        | 2019-02-17 | 1        | 800   |</span><br><span class="line">| 2         | 2          | 3        | 2019-06-02 | 1        | 800   |</span><br><span class="line">| 3         | 3          | 4        | 2019-05-13 | 2        | 2800  |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">输出：</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| product_id  | product_name |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| 1           | S8           |</span><br><span class="line">+-------------+--------------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：分组+having筛选</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span> s.product_id,p.product_name</span><br><span class="line"><span class="keyword">from</span> Product p <span class="keyword">join</span> Sales s</span><br><span class="line"> <span class="keyword">using</span>(product_id)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> s.product_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">min</span>(s.sale_date)<span class="operator">&gt;=</span><span class="string">&#x27;2019-01-01&#x27;</span> <span class="keyword">AND</span> <span class="built_in">MAX</span>(s.sale_date) <span class="operator">&lt;=</span> <span class="string">&#x27;2019-03-31&#x27;</span></span><br></pre></td></tr></table></figure>
<p>having和where区别<br>having可以使用聚合函数，多用于筛选分组</p>
<h2 id="596-超过5名学生的课"><a href="#596-超过5名学生的课" class="headerlink" title="596. 超过5名学生的课"></a><strong>596. 超过5名学生的课</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">SQL Schema</span><br><span class="line">表: Courses</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| student     | varchar |</span><br><span class="line">| class       | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">(student, class)是该表的主键列。</span><br><span class="line">该表的每一行表示学生的名字和他们注册的班级。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写一个SQL查询来报告 至少有5个学生 的所有班级。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式如下所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入: </span><br><span class="line">Courses table:</span><br><span class="line">+---------+----------+</span><br><span class="line">| student | class    |</span><br><span class="line">+---------+----------+</span><br><span class="line">| A       | Math     |</span><br><span class="line">| B       | English  |</span><br><span class="line">| C       | Math     |</span><br><span class="line">| D       | Biology  |</span><br><span class="line">| E       | Math     |</span><br><span class="line">| F       | Computer |</span><br><span class="line">| G       | Math     |</span><br><span class="line">| H       | Math     |</span><br><span class="line">| I       | Math     |</span><br><span class="line">+---------+----------+</span><br><span class="line">输出: </span><br><span class="line">+---------+ </span><br><span class="line">| class   | </span><br><span class="line">+---------+ </span><br><span class="line">| Math    | </span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：分组+having</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> class</span><br><span class="line"><span class="keyword">from</span> Courses</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> class</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;=</span><span class="number">5</span></span><br></pre></td></tr></table></figure>
<h2 id="1729-求关注者的数量"><a href="#1729-求关注者的数量" class="headerlink" title="1729. 求关注者的数量"></a><strong>1729. 求关注者的数量</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">表： Followers</span><br><span class="line"></span><br><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| user_id     | int  |</span><br><span class="line">| follower_id | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">(user_id, follower_id) 是这个表的主键。</span><br><span class="line">该表包含一个关注关系中关注者和用户的编号，其中关注者关注用户。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">写出 SQL 语句，对于每一个用户，返回该用户的关注者数量。</span><br><span class="line"></span><br><span class="line">按 user_id 的顺序返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果的格式如下示例所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Followers 表：</span><br><span class="line">+---------+-------------+</span><br><span class="line">| user_id | follower_id |</span><br><span class="line">+---------+-------------+</span><br><span class="line">| 0       | 1           |</span><br><span class="line">| 1       | 0           |</span><br><span class="line">| 2       | 0           |</span><br><span class="line">| 2       | 1           |</span><br><span class="line">+---------+-------------+</span><br><span class="line">输出：</span><br><span class="line">+---------+----------------+</span><br><span class="line">| user_id | followers_count|</span><br><span class="line">+---------+----------------+</span><br><span class="line">| 0       | 1              |</span><br><span class="line">| 1       | 1              |</span><br><span class="line">| 2       | 2              |</span><br><span class="line">+---------+----------------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：分组+聚合+排序</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span> user_id ,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> followers_count</span><br><span class="line"><span class="keyword">from</span> Followers</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> user_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> user_id</span><br></pre></td></tr></table></figure>
<h2 id="619-只出现一次的最大数字"><a href="#619-只出现一次的最大数字" class="headerlink" title="619. 只出现一次的最大数字"></a><strong>619. 只出现一次的最大数字</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">MyNumbers 表：</span><br><span class="line"></span><br><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| num         | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">这张表没有主键。可能包含重复数字。</span><br><span class="line">这张表的每一行都含有一个整数。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">单一数字 是在 MyNumbers 表中只出现一次的数字。</span><br><span class="line"></span><br><span class="line">请你编写一个 SQL 查询来报告最大的 单一数字 。如果不存在 单一数字 ，查询需报告 null 。</span><br><span class="line"></span><br><span class="line">查询结果如下例所示。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">示例 1：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">MyNumbers 表：</span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">| 8   |</span><br><span class="line">| 8   |</span><br><span class="line">| 3   |</span><br><span class="line">| 3   |</span><br><span class="line">| 1   |</span><br><span class="line">| 4   |</span><br><span class="line">| 5   |</span><br><span class="line">| 6   |</span><br><span class="line">+-----+</span><br><span class="line">输出：</span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">| 6   |</span><br><span class="line">+-----+</span><br><span class="line">解释：单一数字有 1、4、5 和 6 。</span><br><span class="line">6 是最大的单一数字，返回 6 。</span><br><span class="line">示例 2：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">MyNumbers table:</span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">| 8   |</span><br><span class="line">| 8   |</span><br><span class="line">| 7   |</span><br><span class="line">| 7   |</span><br><span class="line">| 3   |</span><br><span class="line">| 3   |</span><br><span class="line">| 3   |</span><br><span class="line">+-----+</span><br><span class="line">输出：</span><br><span class="line">+------+</span><br><span class="line">| num  |</span><br><span class="line">+------+</span><br><span class="line">| null |</span><br><span class="line">+------+</span><br><span class="line">解释：输入的表中不存在单一数字，所以返回 null 。</span><br></pre></td></tr></table></figure>
<p><strong>解法：分组+子查询</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(a.num) <span class="keyword">as</span> num</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(num) <span class="keyword">as</span> num</span><br><span class="line"><span class="keyword">from</span> MyNumbers </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> num </span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">=</span><span class="number">1</span></span><br><span class="line">) a</span><br></pre></td></tr></table></figure>
<p><strong>解法二：不用子查询</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IF(<span class="built_in">COUNT</span>(num)<span class="operator">=</span><span class="number">1</span>, num, <span class="keyword">NULL</span>) <span class="keyword">AS</span> num</span><br><span class="line"><span class="keyword">FROM</span> MyNumbers</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> num</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">COUNT</span>(num), num <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="1045-买下所有产品的客户"><a href="#1045-买下所有产品的客户" class="headerlink" title="1045. 买下所有产品的客户"></a><strong>1045. 买下所有产品的客户</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">Customer 表：</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| customer_id | int     |</span><br><span class="line">| product_key | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">product_key 是 Customer 表的外键。</span><br><span class="line">Product 表：</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| product_key | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">product_key 是这张表的主键。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">写一条 SQL 查询语句，从 Customer 表中查询购买了 Product 表中所有产品的客户的 id。</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line"></span><br><span class="line">Customer 表：</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| customer_id | product_key |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 5           |</span><br><span class="line">| 2           | 6           |</span><br><span class="line">| 3           | 5           |</span><br><span class="line">| 3           | 6           |</span><br><span class="line">| 1           | 6           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Product 表：</span><br><span class="line">+-------------+</span><br><span class="line">| product_key |</span><br><span class="line">+-------------+</span><br><span class="line">| 5           |</span><br><span class="line">| 6           |</span><br><span class="line">+-------------+</span><br><span class="line"></span><br><span class="line">Result 表：</span><br><span class="line">+-------------+</span><br><span class="line">| customer_id |</span><br><span class="line">+-------------+</span><br><span class="line">| 1           |</span><br><span class="line">| 3           |</span><br><span class="line">+-------------+</span><br><span class="line">购买了所有产品（5 和 6）的客户的 id 是 1 和 3 。</span><br></pre></td></tr></table></figure>
<p><strong>解法：子查询+分组+聚合</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span> customer_id</span><br><span class="line"><span class="keyword">from</span> Customer </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> product_key) <span class="operator">=</span> (</span><br><span class="line">  <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> num</span><br><span class="line">  <span class="keyword">from</span> Product </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h1 id="高级查询和连接"><a href="#高级查询和连接" class="headerlink" title="高级查询和连接"></a>高级查询和连接</h1><h2 id="1731-每位经理的下属员工数量"><a href="#1731-每位经理的下属员工数量" class="headerlink" title="1731. 每位经理的下属员工数量"></a><strong>1731. 每位经理的下属员工数量</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Table: Employees</span><br><span class="line"></span><br><span class="line">+-------------+----------+</span><br><span class="line">| Column Name | Type     |</span><br><span class="line">+-------------+----------+</span><br><span class="line">| employee_id | int      |</span><br><span class="line">| name        | varchar  |</span><br><span class="line">| reports_to  | int      |</span><br><span class="line">| age         | int      |</span><br><span class="line">+-------------+----------+</span><br><span class="line">employee_id 是这个表的主键.</span><br><span class="line">该表包含员工以及需要听取他们汇报的上级经理的ID的信息。 有些员工不需要向任何人汇报（reports_to 为空）。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">对于此问题，我们将至少有一个其他员工需要向他汇报的员工，视为一个经理。</span><br><span class="line"></span><br><span class="line">编写SQL查询需要听取汇报的所有经理的ID、名称、直接向该经理汇报的员工人数，以及这些员工的平均年龄，其中该平均年龄需要四舍五入到最接近的整数。</span><br><span class="line"></span><br><span class="line">返回的结果集需要按照 employee_id 进行排序。</span><br><span class="line"></span><br><span class="line">查询结果的格式如下：</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Employees table:</span><br><span class="line">+-------------+---------+------------+-----+</span><br><span class="line">| employee_id | name    | reports_to | age |</span><br><span class="line">+-------------+---------+------------+-----+</span><br><span class="line">| 9           | Hercy   | null       | 43  |</span><br><span class="line">| 6           | Alice   | 9          | 41  |</span><br><span class="line">| 4           | Bob     | 9          | 36  |</span><br><span class="line">| 2           | Winston | null       | 37  |</span><br><span class="line">+-------------+---------+------------+-----+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+-------+---------------+-------------+</span><br><span class="line">| employee_id | name  | reports_count | average_age |</span><br><span class="line">+-------------+-------+---------------+-------------+</span><br><span class="line">| 9           | Hercy | 2             | 39          |</span><br><span class="line">+-------------+-------+---------------+-------------+</span><br><span class="line">Hercy 有两个需要向他汇报的员工, 他们是 Alice and Bob. 他们的平均年龄是 (41+36)/2 = 38.5, 四舍五入的结果是 39.</span><br></pre></td></tr></table></figure>
<p><strong>解法：子查询+联表+聚合</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span> e1.employee_id,e1.name,e2.reports_count,e2.average_age</span><br><span class="line"><span class="keyword">from</span> Employees e1 <span class="keyword">join</span> (</span><br><span class="line">  <span class="keyword">select</span> reports_to, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> reports_count ,round(<span class="built_in">sum</span>(age)<span class="operator">/</span><span class="built_in">count</span>(<span class="operator">*</span>)) <span class="keyword">as</span> average_age</span><br><span class="line">  <span class="keyword">from</span> Employees</span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> reports_to</span><br><span class="line">) e2 </span><br><span class="line"><span class="keyword">on</span> e1.employee_id <span class="operator">=</span> e2.reports_to</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> e1.employee_id</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> m.employee_id,</span><br><span class="line">    m.name,</span><br><span class="line">    <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> reports_count,</span><br><span class="line">    round(<span class="built_in">avg</span>(e.age),<span class="number">0</span>) <span class="keyword">as</span> average_age</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Employees e </span><br><span class="line"><span class="keyword">join</span> Employees m</span><br><span class="line"><span class="keyword">on</span> e.reports_to <span class="operator">=</span> m.employee_id </span><br><span class="line"></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> m.employee_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> employee_id</span><br></pre></td></tr></table></figure>
<h2 id="1789-员工的直属部门"><a href="#1789-员工的直属部门" class="headerlink" title="1789. 员工的直属部门"></a><strong>1789. 员工的直属部门</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">Table: Employee</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   |  Type   |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| employee_id   | int     |</span><br><span class="line">| department_id | int     |</span><br><span class="line">| primary_flag  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">这张表的主键为 employee_id, department_id</span><br><span class="line">employee_id 是员工的ID</span><br><span class="line">department_id 是部门的ID，表示员工与该部门有关系</span><br><span class="line">primary_flag 是一个枚举类型，值分别为(&#x27;Y&#x27;, &#x27;N&#x27;). 如果值为&#x27;Y&#x27;,表示该部门是员工的直属部门。 如果值是&#x27;N&#x27;,则否</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">一个员工可以属于多个部门。</span><br><span class="line"></span><br><span class="line">当一个员工加入超过一个部门的时候，他需要决定哪个部门是他的直属部门。</span><br><span class="line"></span><br><span class="line">请注意，当员工只加入一个部门的时候，那这个部门将默认为他的直属部门，虽然表记录的值为&#x27;N&#x27;.</span><br><span class="line"></span><br><span class="line">请编写一段SQL，查出员工所属的直属部门。</span><br><span class="line"></span><br><span class="line">返回结果没有顺序要求。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line"></span><br><span class="line">Employee table:</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line">| employee_id | department_id | primary_flag |</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line">| 1           | 1             | N            |</span><br><span class="line">| 2           | 1             | Y            |</span><br><span class="line">| 2           | 2             | N            |</span><br><span class="line">| 3           | 3             | N            |</span><br><span class="line">| 4           | 2             | N            |</span><br><span class="line">| 4           | 3             | Y            |</span><br><span class="line">| 4           | 4             | N            |</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| employee_id | department_id |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | 1             |</span><br><span class="line">| 2           | 1             |</span><br><span class="line">| 3           | 3             |</span><br><span class="line">| 4           | 3             |</span><br><span class="line">+-------------+---------------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：联合查询</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> employee_id ,department_id</span><br><span class="line"><span class="keyword">from</span> Employee </span><br><span class="line"><span class="keyword">where</span> primary_flag <span class="operator">=</span><span class="string">&#x27;Y&#x27;</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> employee_id ,department_id</span><br><span class="line"><span class="keyword">from</span> Employee</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> employee_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="610-判断三角形"><a href="#610-判断三角形" class="headerlink" title="610. 判断三角形"></a><strong>610. 判断三角形</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">表: Triangle</span><br><span class="line"></span><br><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| x           | int  |</span><br><span class="line">| y           | int  |</span><br><span class="line">| z           | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">(x, y, z)是该表的主键列。</span><br><span class="line">该表的每一行包含三个线段的长度。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">写一个SQL查询，每三个线段报告它们是否可以形成一个三角形。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式如下所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入: </span><br><span class="line">Triangle 表:</span><br><span class="line">+----+----+----+</span><br><span class="line">| x  | y  | z  |</span><br><span class="line">+----+----+----+</span><br><span class="line">| 13 | 15 | 30 |</span><br><span class="line">| 10 | 20 | 15 |</span><br><span class="line">+----+----+----+</span><br><span class="line">输出: </span><br><span class="line">+----+----+----+----------+</span><br><span class="line">| x  | y  | z  | triangle |</span><br><span class="line">+----+----+----+----------+</span><br><span class="line">| 13 | 15 | 30 | No       |</span><br><span class="line">| 10 | 20 | 15 | Yes      |</span><br><span class="line">+----+----+----+----------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：if</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> x,y,z,if(x<span class="operator">+</span>y<span class="operator">&gt;</span>z<span class="operator">&amp;&amp;</span>x<span class="operator">+</span>z<span class="operator">&gt;</span>y<span class="operator">&amp;&amp;</span>y<span class="operator">+</span>z<span class="operator">&gt;</span>x,<span class="string">&#x27;Yes&#x27;</span>,<span class="string">&#x27;No&#x27;</span>) <span class="keyword">as</span> triangle</span><br><span class="line"><span class="keyword">from</span> Triangle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    x,</span><br><span class="line">    y,</span><br><span class="line">    z,</span><br><span class="line">    <span class="keyword">CASE</span></span><br><span class="line">        <span class="keyword">WHEN</span> x <span class="operator">+</span> y <span class="operator">&gt;</span> z <span class="keyword">AND</span> x <span class="operator">+</span> z <span class="operator">&gt;</span> y <span class="keyword">AND</span> y <span class="operator">+</span> z <span class="operator">&gt;</span> x <span class="keyword">THEN</span> <span class="string">&#x27;Yes&#x27;</span></span><br><span class="line">        <span class="keyword">ELSE</span> <span class="string">&#x27;No&#x27;</span></span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">&#x27;triangle&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    triangle</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">#<span class="keyword">case</span>类似于java中的switch</span><br></pre></td></tr></table></figure>
<h2 id="180-连续出现的数字"><a href="#180-连续出现的数字" class="headerlink" title="180. 连续出现的数字"></a><strong>180. 连续出现的数字</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">表：Logs</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| id          | int     |</span><br><span class="line">| num         | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">id 是这个表的主键。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写一个 SQL 查询，查找所有至少连续出现三次的数字。</span><br><span class="line"></span><br><span class="line">返回的结果表中的数据可以按 任意顺序 排列。</span><br><span class="line"></span><br><span class="line">查询结果格式如下面的例子所示：</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Logs 表：</span><br><span class="line">+----+-----+</span><br><span class="line">| Id | Num |</span><br><span class="line">+----+-----+</span><br><span class="line">| 1  | 1   |</span><br><span class="line">| 2  | 1   |</span><br><span class="line">| 3  | 1   |</span><br><span class="line">| 4  | 2   |</span><br><span class="line">| 5  | 1   |</span><br><span class="line">| 6  | 2   |</span><br><span class="line">| 7  | 2   |</span><br><span class="line">+----+-----+</span><br><span class="line">输出：</span><br><span class="line">Result 表：</span><br><span class="line">+-----------------+</span><br><span class="line">| ConsecutiveNums |</span><br><span class="line">+-----------------+</span><br><span class="line">| 1               |</span><br><span class="line">+-----------------+</span><br><span class="line">解释：1 是唯一连续出现至少三次的数字。</span><br></pre></td></tr></table></figure>
<p><strong>解法：三表联查</strong><br><strong>思路：</strong><br><strong>连续出现意味着相同数字的id是连续的；使用distinct，因为有些数字连续出现次数超过三次所以会有重复值</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> l1.num <span class="keyword">as</span> ConsecutiveNums </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">Logs l1,</span><br><span class="line">Logs l2,</span><br><span class="line">Logs l3</span><br><span class="line"><span class="keyword">where</span> l1.id<span class="operator">+</span><span class="number">1</span><span class="operator">=</span>l2.id </span><br><span class="line"><span class="keyword">and</span> l2.id<span class="operator">+</span><span class="number">1</span> <span class="operator">=</span> l3.id</span><br><span class="line"><span class="keyword">and</span> l1.num <span class="operator">=</span> l2.num</span><br><span class="line"><span class="keyword">and</span> l2.num <span class="operator">=</span> l3.num</span><br><span class="line"></span><br><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> Num <span class="keyword">AS</span> ConsecutiveNums <span class="keyword">FROM</span> Logs </span><br><span class="line"><span class="keyword">WHERE</span> (Id<span class="operator">+</span><span class="number">1</span>, Num) <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Logs)</span><br><span class="line"><span class="keyword">AND</span> (Id<span class="operator">+</span><span class="number">2</span>, Num) <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Logs)</span><br></pre></td></tr></table></figure>
<h2 id="1164-指定日期的产品价格（难！）"><a href="#1164-指定日期的产品价格（难！）" class="headerlink" title="1164. 指定日期的产品价格（难！）"></a><strong>1164. 指定日期的产品价格（难！）</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">产品数据表: Products</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| new_price     | int     |</span><br><span class="line">| change_date   | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">这张表的主键是 (product_id, change_date)。</span><br><span class="line">这张表的每一行分别记录了 某产品 在某个日期 更改后 的新价格。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">写一段 SQL来查找在 2019-08-16 时全部产品的价格，假设所有产品在修改前的价格都是 10 。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式如下例所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Products 表:</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line">| product_id | new_price | change_date |</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line">| 1          | 20        | 2019-08-14  |</span><br><span class="line">| 2          | 50        | 2019-08-14  |</span><br><span class="line">| 1          | 30        | 2019-08-15  |</span><br><span class="line">| 1          | 35        | 2019-08-16  |</span><br><span class="line">| 2          | 65        | 2019-08-17  |</span><br><span class="line">| 3          | 20        | 2019-08-18  |</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line">输出：</span><br><span class="line">+------------+-------+</span><br><span class="line">| product_id | price |</span><br><span class="line">+------------+-------+</span><br><span class="line">| 2          | 50    |</span><br><span class="line">| 1          | 35    |</span><br><span class="line">| 3          | 10    |</span><br><span class="line">+------------+-------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：子查询+外连接+ifnull函数</strong><br><strong>解题思路：</strong><br><strong>对于高级查询较复杂的查询，可以分步解决；求所以产品到2019-8-16的价格</strong></p>
<ol>
<li><p><strong>先找到所以在2019-8-16之前修改过产品价格的产品</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_id,new_price</span><br><span class="line"><span class="keyword">from</span> Products</span><br><span class="line"><span class="keyword">where</span> (product_id,change_date) <span class="keyword">in</span> (</span><br><span class="line"><span class="keyword">select</span> product_id,<span class="built_in">max</span>(change_date)</span><br><span class="line"><span class="keyword">from</span> Products</span><br><span class="line"><span class="keyword">where</span> change_date<span class="operator">&lt;=</span><span class="string">&#x27;2019-08-16&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> product_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p>再获得所有的产品</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> product_id </span><br><span class="line"><span class="keyword">from</span> Products</span><br></pre></td></tr></table></figure>
</li>
<li><p>进行左连接，根据产品id进行匹配，对于在指定时间前修改过价格的产品有new_price，没有在指定时间之前修改过价格的产品，其new_price为null，通过ifnull函数可以给这些产品设置默认价格</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> t1.product_id,ifnull(new_price,<span class="number">10</span>) <span class="keyword">as</span> price</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> <span class="keyword">distinct</span> product_id </span><br><span class="line"><span class="keyword">from</span> Products) t1</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> </span><br><span class="line">(<span class="keyword">select</span> product_id,new_price</span><br><span class="line"><span class="keyword">from</span> Products</span><br><span class="line"><span class="keyword">where</span> (product_id,change_date) <span class="keyword">in</span> (</span><br><span class="line"><span class="keyword">select</span> product_id,<span class="built_in">max</span>(change_date)</span><br><span class="line"><span class="keyword">from</span> Products</span><br><span class="line"><span class="keyword">where</span> change_date<span class="operator">&lt;=</span><span class="string">&#x27;2019-08-16&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> product_id</span><br><span class="line">)) t2 </span><br><span class="line"><span class="keyword">on</span> t1.product_id <span class="operator">=</span> t2.product_id </span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="1204-最后一个能进入电梯的人"><a href="#1204-最后一个能进入电梯的人" class="headerlink" title="1204. 最后一个能进入电梯的人"></a><strong>1204. 最后一个能进入电梯的人</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">表: Queue</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| person_id   | int     |</span><br><span class="line">| person_name | varchar |</span><br><span class="line">| weight      | int     |</span><br><span class="line">| turn        | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">person_id 是这个表的主键。</span><br><span class="line">该表展示了所有等待电梯的人的信息。</span><br><span class="line">表中 person_id 和 turn 列将包含从 1 到 n 的所有数字，其中 n 是表中的行数。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">有一群人在等着上公共汽车。然而，巴士有1000 公斤的重量限制，所以可能会有一些人不能上。</span><br><span class="line"></span><br><span class="line">写一条 SQL 查询语句查找 最后一个 能进入电梯且不超过重量限制的 person_name 。题目确保队列中第一位的人可以进入电梯，不会超重。</span><br><span class="line"></span><br><span class="line">查询结果如下所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Queue 表</span><br><span class="line">+-----------+-------------------+--------+------+</span><br><span class="line">| person_id | person_name       | weight | turn |</span><br><span class="line">+-----------+-------------------+--------+------+</span><br><span class="line">| 5         | George Washington | 250    | 1    |</span><br><span class="line">| 3         | John Adams        | 350    | 2    |</span><br><span class="line">| 6         | Thomas Jefferson  | 400    | 3    |</span><br><span class="line">| 2         | Will Johnliams    | 200    | 4    |</span><br><span class="line">| 4         | Thomas Jefferson  | 175    | 5    |</span><br><span class="line">| 1         | James Elephant    | 500    | 6    |</span><br><span class="line">+-----------+-------------------+--------+------+</span><br><span class="line">输出：</span><br><span class="line">+-------------------+</span><br><span class="line">| person_name       |</span><br><span class="line">+-------------------+</span><br><span class="line">| Thomas Jefferson  |</span><br><span class="line">+-------------------+</span><br><span class="line">解释：</span><br><span class="line">为了简化，Queue 表按 turn 列由小到大排序。</span><br><span class="line">上例中 George Washington(id 5), John Adams(id 3) 和 Thomas Jefferson(id 6) 将可以进入电梯,因为他们的体重和为 250 + 350 + 400 = 1000。</span><br><span class="line">Thomas Jefferson(id 6) 是最后一个体重合适并进入电梯的人。</span><br></pre></td></tr></table></figure>
<p><strong>解法：自连接</strong><br><strong>思路：</strong><br><strong>将表queue进行自连接，再筛选出q1.turn&gt;&#x3D;q2.turn的,根据q1.person_id进行分组，每组的含义即为，电梯最后一个进入的是q1.person_id 里面有turn先于q1.person_id的所有人。再对分组进行筛选，筛选出sum（b.weight）&lt;&#x3D;1000的，筛选出来的即是所有不超载的情况，再根据turn进行倒叙，第一条记录即为载人最多且不超载的情况，此条记录的person_id即为最后一个进入电梯的人。</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> q1.person_name</span><br><span class="line"><span class="keyword">from</span> Queue q1 ,Queue q2</span><br><span class="line"><span class="keyword">where</span> q1.turn<span class="operator">&gt;=</span>q2.turn </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> q1.person_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">sum</span>(q2.weight) <span class="operator">&lt;=</span><span class="number">1000</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> q1.turn <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="1907-按分类统计薪水"><a href="#1907-按分类统计薪水" class="headerlink" title="1907. 按分类统计薪水"></a><strong>1907. 按分类统计薪水</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">表: Accounts</span><br><span class="line"></span><br><span class="line">+-------------+------+</span><br><span class="line">| 列名        | 类型  |</span><br><span class="line">+-------------+------+</span><br><span class="line">| account_id  | int  |</span><br><span class="line">| income      | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">account_id 是这个表的主键。</span><br><span class="line">每一行都包含一个银行帐户的月收入的信息。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">写出一个 SQL 查询，来报告每个工资类别的银行账户数量。 工资类别如下：</span><br><span class="line"></span><br><span class="line">&quot;Low Salary&quot;：所有工资 严格低于 20000 美元。</span><br><span class="line">&quot;Average Salary&quot;： 包含 范围内的所有工资 [$20000, $50000] 。</span><br><span class="line">&quot;High Salary&quot;：所有工资 严格大于 50000 美元。</span><br><span class="line"></span><br><span class="line">结果表 必须 包含所有三个类别。 如果某个类别中没有帐户，则报告 0 。</span><br><span class="line"></span><br><span class="line">按 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式如下示例。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Accounts 表:</span><br><span class="line">+------------+--------+</span><br><span class="line">| account_id | income |</span><br><span class="line">+------------+--------+</span><br><span class="line">| 3          | 108939 |</span><br><span class="line">| 2          | 12747  |</span><br><span class="line">| 8          | 87709  |</span><br><span class="line">| 6          | 91796  |</span><br><span class="line">+------------+--------+</span><br><span class="line">输出：</span><br><span class="line">+----------------+----------------+</span><br><span class="line">| category       | accounts_count |</span><br><span class="line">+----------------+----------------+</span><br><span class="line">| Low Salary     | 1              |</span><br><span class="line">| Average Salary | 0              |</span><br><span class="line">| High Salary    | 3              |</span><br><span class="line">+----------------+----------------+</span><br><span class="line">解释：</span><br><span class="line">低薪: 数量为 2.</span><br><span class="line">中等薪水: 没有.</span><br><span class="line">高薪: 有三个账户，他们是 3, 6和 8.</span><br></pre></td></tr></table></figure>
<p><strong>解法：union</strong><br><strong>使用union合并结果集</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;Low Salary&#x27;</span> <span class="keyword">as</span> category ,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> accounts_count</span><br><span class="line"><span class="keyword">from</span> Accounts</span><br><span class="line"><span class="keyword">where</span> income<span class="operator">&lt;</span><span class="number">20000</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;Average Salary&#x27;</span> <span class="keyword">as</span> category ,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> accounts_count</span><br><span class="line"><span class="keyword">from</span> Accounts</span><br><span class="line"><span class="keyword">where</span> income <span class="operator">&gt;=</span><span class="number">20000</span> <span class="keyword">and</span> income <span class="operator">&lt;=</span><span class="number">50000</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;High Salary&#x27;</span> <span class="keyword">as</span> category ,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> accounts_count</span><br><span class="line"><span class="keyword">from</span> Accounts</span><br><span class="line"><span class="keyword">where</span> income <span class="operator">&gt;</span><span class="number">50000</span></span><br></pre></td></tr></table></figure>
<p>我们可以自定义字段值和字段名。</p>
<h1 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h1><h2 id="1978-上级经理已离职的公司员工"><a href="#1978-上级经理已离职的公司员工" class="headerlink" title="1978. 上级经理已离职的公司员工"></a><strong>1978. 上级经理已离职的公司员工</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">表: Employees</span><br><span class="line"></span><br><span class="line">+-------------+----------+</span><br><span class="line">| Column Name | Type     |</span><br><span class="line">+-------------+----------+</span><br><span class="line">| employee_id | int      |</span><br><span class="line">| name        | varchar  |</span><br><span class="line">| manager_id  | int      |</span><br><span class="line">| salary      | int      |</span><br><span class="line">+-------------+----------+</span><br><span class="line">employee_id 是这个表的主键。</span><br><span class="line">这个表包含了员工，他们的薪水和上级经理的id。</span><br><span class="line">有一些员工没有上级经理（其manager_id 是空值）。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">写一个查询语句，查询出，这些员工的id，他们的薪水严格少于$30000 并且他们的上级经理已离职。当一个经理离开公司时，他们的信息需要从员工表中删除掉，但是表中的员工的manager_id  这一列还是设置的离职经理的id 。</span><br><span class="line"></span><br><span class="line">返回的结果按照employee_id 从小到大排序。</span><br><span class="line"></span><br><span class="line">查询结果如下所示：</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Employees table:</span><br><span class="line">+-------------+-----------+------------+--------+</span><br><span class="line">| employee_id | name      | manager_id | salary |</span><br><span class="line">+-------------+-----------+------------+--------+</span><br><span class="line">| 3           | Mila      | 9          | 60301  |</span><br><span class="line">| 12          | Antonella | null       | 31000  |</span><br><span class="line">| 13          | Emery     | null       | 67084  |</span><br><span class="line">| 1           | Kalel     | 11         | 21241  |</span><br><span class="line">| 9           | Mikaela   | null       | 50937  |</span><br><span class="line">| 11          | Joziah    | 6          | 28485  |</span><br><span class="line">+-------------+-----------+------------+--------+</span><br><span class="line">输出：</span><br><span class="line">+-------------+</span><br><span class="line">| employee_id |</span><br><span class="line">+-------------+</span><br><span class="line">| 11          |</span><br><span class="line">+-------------+</span><br></pre></td></tr></table></figure>
<p><strong>解法一：子查询</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> employee_id</span><br><span class="line"><span class="keyword">from</span> Employees</span><br><span class="line"><span class="keyword">where</span> salary<span class="operator">&lt;</span><span class="number">30000</span> <span class="keyword">and</span> manager_id <span class="keyword">not</span> <span class="keyword">in</span>(</span><br><span class="line">  #查找出所有员工</span><br><span class="line">  <span class="keyword">select</span> <span class="keyword">distinct</span> employee_id</span><br><span class="line">  <span class="keyword">from</span> Employees</span><br><span class="line">) </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> employee_id</span><br></pre></td></tr></table></figure>
<p><strong>解法二：自连接</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e1.employee_id <span class="keyword">from</span> Employees e1 <span class="keyword">left</span> <span class="keyword">join</span> Employees e2</span><br><span class="line"><span class="keyword">on</span> e1.manager_id <span class="operator">=</span>e2.employee_id </span><br><span class="line"><span class="keyword">where</span> e1.manager_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">and</span> e2.employee_id <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">and</span> e1.salary<span class="operator">&lt;</span><span class="number">30000</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> e1.employee_id </span><br></pre></td></tr></table></figure>
<h2 id="626-换座位"><a href="#626-换座位" class="headerlink" title="626. 换座位"></a><strong>626. 换座位</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">表: Seat</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| id          | int     |</span><br><span class="line">| name        | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">Id是该表的主键列。</span><br><span class="line">该表的每一行都表示学生的姓名和ID。</span><br><span class="line">Id是一个连续的增量。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写SQL查询来交换每两个连续的学生的座位号。如果学生的数量是奇数，则最后一个学生的id不交换。</span><br><span class="line"></span><br><span class="line">按 id 升序 返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式如下所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入: </span><br><span class="line">Seat 表:</span><br><span class="line">+----+---------+</span><br><span class="line">| id | student |</span><br><span class="line">+----+---------+</span><br><span class="line">| 1  | Abbot   |</span><br><span class="line">| 2  | Doris   |</span><br><span class="line">| 3  | Emerson |</span><br><span class="line">| 4  | Green   |</span><br><span class="line">| 5  | Jeames  |</span><br><span class="line">+----+---------+</span><br><span class="line">输出: </span><br><span class="line">+----+---------+</span><br><span class="line">| id | student |</span><br><span class="line">+----+---------+</span><br><span class="line">| 1  | Doris   |</span><br><span class="line">| 2  | Abbot   |</span><br><span class="line">| 3  | Green   |</span><br><span class="line">| 4  | Emerson |</span><br><span class="line">| 5  | Jeames  |</span><br><span class="line">+----+---------+</span><br><span class="line">解释:</span><br><span class="line">请注意，如果学生人数为奇数，则不需要更换最后一名学生的座位。</span><br></pre></td></tr></table></figure>
<p><strong>解法：case+子查询</strong><br><strong>代码如下：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select (case</span><br><span class="line">  when mod(id,2)=1 and id=(select count(*)from Seat) then id</span><br><span class="line">  when mod(id,2)=1 then id+1</span><br><span class="line">  else id-1</span><br><span class="line">end ) as id ,student</span><br><span class="line">from Seat</span><br><span class="line">order by id asc</span><br></pre></td></tr></table></figure>
<h2 id="1341-电影评分"><a href="#1341-电影评分" class="headerlink" title="1341. 电影评分"></a><strong>1341. 电影评分</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">表：Movies</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| movie_id      | int     |</span><br><span class="line">| title         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">movie_id 是这个表的主键。</span><br><span class="line">title 是电影的名字。</span><br><span class="line">表：Users</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">user_id 是表的主键。</span><br><span class="line">表：MovieRating</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| movie_id      | int     |</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| rating        | int     |</span><br><span class="line">| created_at    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(movie_id, user_id) 是这个表的主键。</span><br><span class="line">这个表包含用户在其评论中对电影的评分 rating 。</span><br><span class="line">created_at 是用户的点评日期。 </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">请你编写一组 SQL 查询：</span><br><span class="line"></span><br><span class="line">查找评论电影数量最多的用户名。如果出现平局，返回字典序较小的用户名。</span><br><span class="line">查找在 February 2020 平均评分最高 的电影名称。如果出现平局，返回字典序较小的电影名称。</span><br><span class="line">字典序 ，即按字母在字典中出现顺序对字符串排序，字典序较小则意味着排序靠前。</span><br><span class="line"></span><br><span class="line">查询结果格式如下例所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Movies 表：</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| movie_id    |  title       |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| 1           | Avengers     |</span><br><span class="line">| 2           | Frozen 2     |</span><br><span class="line">| 3           | Joker        |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">Users 表：</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| user_id     |  name        |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| 1           | Daniel       |</span><br><span class="line">| 2           | Monica       |</span><br><span class="line">| 3           | Maria        |</span><br><span class="line">| 4           | James        |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">MovieRating 表：</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| movie_id    | user_id      | rating       | created_at  |</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| 1           | 1            | 3            | 2020-01-12  |</span><br><span class="line">| 1           | 2            | 4            | 2020-02-11  |</span><br><span class="line">| 1           | 3            | 2            | 2020-02-12  |</span><br><span class="line">| 1           | 4            | 1            | 2020-01-01  |</span><br><span class="line">| 2           | 1            | 5            | 2020-02-17  | </span><br><span class="line">| 2           | 2            | 2            | 2020-02-01  | </span><br><span class="line">| 2           | 3            | 2            | 2020-03-01  |</span><br><span class="line">| 3           | 1            | 3            | 2020-02-22  | </span><br><span class="line">| 3           | 2            | 4            | 2020-02-25  | </span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">输出：</span><br><span class="line">Result 表：</span><br><span class="line">+--------------+</span><br><span class="line">| results      |</span><br><span class="line">+--------------+</span><br><span class="line">| Daniel       |</span><br><span class="line">| Frozen 2     |</span><br><span class="line">+--------------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：union all连接结果集</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">(<span class="keyword">select</span> u.name <span class="keyword">as</span> results</span><br><span class="line"><span class="keyword">from</span> MovieRating m <span class="keyword">join</span> Users u</span><br><span class="line"><span class="keyword">on</span> m.user_id<span class="operator">=</span>u.user_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> m.user_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">desc</span>,u.name <span class="keyword">asc</span></span><br><span class="line">limit <span class="number">1</span>)</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span>(</span><br><span class="line"><span class="keyword">select</span> m2.title <span class="keyword">as</span> results</span><br><span class="line"><span class="keyword">from</span> MovieRating m1 <span class="keyword">join</span> Movies m2</span><br><span class="line"><span class="keyword">on</span> m1.movie_id <span class="operator">=</span> m2.movie_id</span><br><span class="line"><span class="keyword">where</span> m1.created_at<span class="operator">&gt;=</span><span class="string">&#x27;2020-02-01&#x27;</span><span class="keyword">and</span> m1.created_at<span class="operator">&lt;</span><span class="string">&#x27;2020-03-01&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> m1.movie_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">avg</span>(m1.rating) <span class="keyword">desc</span>,m2.title <span class="keyword">asc</span></span><br><span class="line">limit <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="1321-餐馆营业额变化增长"><a href="#1321-餐馆营业额变化增长" class="headerlink" title="1321. 餐馆营业额变化增长"></a><strong>1321. 餐馆营业额变化增长</strong></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">表: Customer</span><br><span class="line"></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Column</span> Name   <span class="operator">|</span> Type    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line"><span class="operator">|</span> customer_id   <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> name          <span class="operator">|</span> <span class="type">varchar</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> visited_on    <span class="operator">|</span> <span class="type">date</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> amount        <span class="operator">|</span> <span class="type">int</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------+</span></span><br><span class="line">(customer_id, visited_on) 是该表的主键。</span><br><span class="line">该表包含一家餐馆的顾客交易数据。</span><br><span class="line">visited_on 表示 (customer_id) 的顾客在 visited_on 那天访问了餐馆。</span><br><span class="line">amount 是一个顾客某一天的消费总额。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">你是餐馆的老板，现在你想分析一下可能的营业额变化增长（每天至少有一位顾客）。</span><br><span class="line"></span><br><span class="line">写一条 <span class="keyword">SQL</span> 查询计算以 <span class="number">7</span> 天（某日期 <span class="operator">+</span> 该日期前的 <span class="number">6</span> 天）为一个时间段的顾客消费平均值。average_amount 要 保留两位小数。</span><br><span class="line"></span><br><span class="line">查询结果按 visited_on 排序。</span><br><span class="line"></span><br><span class="line">查询结果格式的例子如下。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Customer 表:</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+--------------+--------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> customer_id <span class="operator">|</span> name         <span class="operator">|</span> visited_on   <span class="operator">|</span> amount      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+--------------+--------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>           <span class="operator">|</span> Jhon         <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-01</span>   <span class="operator">|</span> <span class="number">100</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>           <span class="operator">|</span> Daniel       <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-02</span>   <span class="operator">|</span> <span class="number">110</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>           <span class="operator">|</span> Jade         <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-03</span>   <span class="operator">|</span> <span class="number">120</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>           <span class="operator">|</span> Khaled       <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-04</span>   <span class="operator">|</span> <span class="number">130</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5</span>           <span class="operator">|</span> Winston      <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-05</span>   <span class="operator">|</span> <span class="number">110</span>         <span class="operator">|</span> </span><br><span class="line"><span class="operator">|</span> <span class="number">6</span>           <span class="operator">|</span> Elvis        <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-06</span>   <span class="operator">|</span> <span class="number">140</span>         <span class="operator">|</span> </span><br><span class="line"><span class="operator">|</span> <span class="number">7</span>           <span class="operator">|</span> Anna         <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-07</span>   <span class="operator">|</span> <span class="number">150</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">8</span>           <span class="operator">|</span> Maria        <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-08</span>   <span class="operator">|</span> <span class="number">80</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">9</span>           <span class="operator">|</span> Jaze         <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-09</span>   <span class="operator">|</span> <span class="number">110</span>         <span class="operator">|</span> </span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>           <span class="operator">|</span> Jhon         <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-10</span>   <span class="operator">|</span> <span class="number">130</span>         <span class="operator">|</span> </span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>           <span class="operator">|</span> Jade         <span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-10</span>   <span class="operator">|</span> <span class="number">150</span>         <span class="operator">|</span> </span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+--------------+--------------+-------------+</span></span><br><span class="line">输出：</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+--------------+----------------+</span></span><br><span class="line"><span class="operator">|</span> visited_on   <span class="operator">|</span> amount       <span class="operator">|</span> average_amount <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+--------------+----------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-07</span>   <span class="operator">|</span> <span class="number">860</span>          <span class="operator">|</span> <span class="number">122.86</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-08</span>   <span class="operator">|</span> <span class="number">840</span>          <span class="operator">|</span> <span class="number">120</span>            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-09</span>   <span class="operator">|</span> <span class="number">840</span>          <span class="operator">|</span> <span class="number">120</span>            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2019</span><span class="number">-01</span><span class="number">-10</span>   <span class="operator">|</span> <span class="number">1000</span>         <span class="operator">|</span> <span class="number">142.86</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+--------------+----------------+</span></span><br></pre></td></tr></table></figure>
<p><strong>解法：窗口函数（好用）</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    visited_on, amount, average_amount</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">        <span class="keyword">distinct</span> visited_on,  # 因为窗口函数是按照日期计算的。所以相同日期的结果也是相同的，直接去重即可</span><br><span class="line">        <span class="built_in">sum</span>(amount) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> visited_on <span class="keyword">range</span> <span class="type">interval</span> <span class="number">6</span> <span class="keyword">day</span> preceding) amount, # 按照日期排序，范围是当前日期和当前日期的前六天</span><br><span class="line">        round(<span class="built_in">sum</span>(amount) <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> visited_on <span class="keyword">range</span> <span class="type">interval</span> <span class="number">6</span> <span class="keyword">day</span> preceding)<span class="operator">/</span><span class="number">7</span>, <span class="number">2</span>) average_amount # 同理</span><br><span class="line">    <span class="keyword">from</span> </span><br><span class="line">        Customer) t</span><br><span class="line"><span class="keyword">where</span> datediff(visited_on, (<span class="keyword">select</span> <span class="built_in">min</span>(visited_on) <span class="keyword">from</span> Customer))<span class="operator">&gt;=</span><span class="number">6</span> #去除日期不足<span class="number">7</span>日的结果</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> visited_on;</span><br></pre></td></tr></table></figure>
<p><strong>窗口函数用法：</strong><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/WHYbeHERE/article/details/127896098"><strong>窗口函数的用法</strong></a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/Ahuuua/article/details/127136611"><strong>窗口函数的用法</strong></a></p>
<h2 id="602-好友申请-II-：谁有最多的好友"><a href="#602-好友申请-II-：谁有最多的好友" class="headerlink" title="602. 好友申请 II ：谁有最多的好友"></a><strong>602. 好友申请 II ：谁有最多的好友</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">在 Facebook 或者 Twitter 这样的社交应用中，人们经常会发好友申请也会收到其他人的好友申请。</span><br><span class="line"></span><br><span class="line">RequestAccepted 表：</span><br><span class="line"></span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| requester_id   | int     |</span><br><span class="line">| accepter_id    | int     |</span><br><span class="line">| accept_date    | date    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">(requester_id, accepter_id) 是这张表的主键。</span><br><span class="line">这张表包含发送好友请求的人的 ID ，接收好友请求的人的 ID ，以及好友请求通过的日期。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">写一个查询语句，找出拥有最多的好友的人和他拥有的好友数目。</span><br><span class="line"></span><br><span class="line">生成的测试用例保证拥有最多好友数目的只有 1 个人。</span><br><span class="line"></span><br><span class="line">查询结果格式如下例所示。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">RequestAccepted 表：</span><br><span class="line">+--------------+-------------+-------------+</span><br><span class="line">| requester_id | accepter_id | accept_date |</span><br><span class="line">+--------------+-------------+-------------+</span><br><span class="line">| 1            | 2           | 2016/06/03  |</span><br><span class="line">| 1            | 3           | 2016/06/08  |</span><br><span class="line">| 2            | 3           | 2016/06/08  |</span><br><span class="line">| 3            | 4           | 2016/06/09  |</span><br><span class="line">+--------------+-------------+-------------+</span><br><span class="line">输出：</span><br><span class="line">+----+-----+</span><br><span class="line">| id | num |</span><br><span class="line">+----+-----+</span><br><span class="line">| 3  | 3   |</span><br><span class="line">+----+-----+</span><br><span class="line">解释：</span><br><span class="line">编号为 3 的人是编号为 1 ，2 和 4 的人的好友，所以他总共有 3 个好友，比其他人都多。</span><br></pre></td></tr></table></figure>
<p><strong>解法：子查询+union all</strong><br><strong>成为朋友是一个双向的过程，所以如果一个人接受了另一个人的请求，他们两个都会多拥有一个朋友。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> rid <span class="keyword">as</span> id ,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> num</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> r1.requester_id <span class="keyword">as</span> rid ,r1.accepter_id <span class="keyword">as</span> aid </span><br><span class="line">    <span class="keyword">from</span> RequestAccepted <span class="keyword">as</span> r1</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">    <span class="keyword">select</span> r2.accepter_id <span class="keyword">as</span> rid ,r2.requester_id <span class="keyword">as</span> aid </span><br><span class="line">    <span class="keyword">from</span> RequestAccepted <span class="keyword">as</span> r2 </span><br><span class="line">) a </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> rid</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> num <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="585-2016年的投资"><a href="#585-2016年的投资" class="headerlink" title="585. 2016年的投资"></a><strong>585. 2016年的投资</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">Insurance 表：</span><br><span class="line"></span><br><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| pid         | int   |</span><br><span class="line">| tiv_2015    | float |</span><br><span class="line">| tiv_2016    | float |</span><br><span class="line">| lat         | float |</span><br><span class="line">| lon         | float |</span><br><span class="line">+-------------+-------+</span><br><span class="line">pid 是这张表的主键。</span><br><span class="line">表中的每一行都包含一条保险信息，其中：</span><br><span class="line">pid 是投保人的投保编号。</span><br><span class="line">tiv_2015 是该投保人在 2015 年的总投保金额，tiv_2016 是该投保人在 2016 年的总投保金额。</span><br><span class="line">lat 是投保人所在城市的纬度。题目数据确保 lat 不为空。</span><br><span class="line">lon 是投保人所在城市的经度。题目数据确保 lon 不为空。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">请你编写一个 SQL 查询，报告 2016 年 (tiv_2016) 所有满足下述条件的投保人的投保金额之和：</span><br><span class="line"></span><br><span class="line">他在 2015 年的投保额 (tiv_2015) 至少跟一个其他投保人在 2015 年的投保额相同。</span><br><span class="line">他所在的城市必须与其他投保人都不同（也就是说 (lat, lon) 不能跟其他任何一个投保人完全相同）。</span><br><span class="line">tiv_2016 四舍五入的 两位小数 。</span><br><span class="line"></span><br><span class="line">查询结果格式如下例所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Insurance 表：</span><br><span class="line">+-----+----------+----------+-----+-----+</span><br><span class="line">| pid | tiv_2015 | tiv_2016 | lat | lon |</span><br><span class="line">+-----+----------+----------+-----+-----+</span><br><span class="line">| 1   | 10       | 5        | 10  | 10  |</span><br><span class="line">| 2   | 20       | 20       | 20  | 20  |</span><br><span class="line">| 3   | 10       | 30       | 20  | 20  |</span><br><span class="line">| 4   | 10       | 40       | 40  | 40  |</span><br><span class="line">+-----+----------+----------+-----+-----+</span><br><span class="line">输出：</span><br><span class="line">+----------+</span><br><span class="line">| tiv_2016 |</span><br><span class="line">+----------+</span><br><span class="line">| 45.00    |</span><br><span class="line">+----------+</span><br><span class="line">解释：</span><br><span class="line">表中的第一条记录和最后一条记录都满足两个条件。</span><br><span class="line">tiv_2015 值为 10 与第三条和第四条记录相同，且其位置是唯一的。</span><br><span class="line">第二条记录不符合任何一个条件。其 tiv_2015 与其他投保人不同，并且位置与第三条记录相同，这也导致了第三条记录不符合题目要求。</span><br><span class="line">因此，结果是第一条记录和最后一条记录的 tiv_2016 之和，即 45 。</span><br></pre></td></tr></table></figure>
<p><strong>解法：子查询</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round(<span class="built_in">sum</span>(tiv_2016),<span class="number">2</span>) <span class="keyword">as</span> tiv_2016</span><br><span class="line"><span class="keyword">from</span> Insurance</span><br><span class="line"><span class="keyword">where</span> tiv_2015 <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">select</span> tiv_2015</span><br><span class="line">    <span class="keyword">from</span> Insurance </span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> tiv_2015</span><br><span class="line">    <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;=</span><span class="number">2</span></span><br><span class="line">) <span class="keyword">and</span> pid <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">select</span> pid </span><br><span class="line">    <span class="keyword">from</span> Insurance</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> lat,lon</span><br><span class="line">    <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">=</span><span class="number">1</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>解法二：窗口函数</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  round(<span class="built_in">sum</span>(tiv_2016), <span class="number">2</span>) tiv_2016</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> tiv_2016,</span><br><span class="line">    <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> tiv_2015) <span class="keyword">as</span> count_tiv_2015,</span><br><span class="line">    <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> lat,lon) <span class="keyword">as</span> count_lat_lon</span><br><span class="line">    <span class="keyword">from</span> insurance</span><br><span class="line">) <span class="keyword">as</span> temp <span class="keyword">where</span> temp.count_tiv_2015<span class="operator">&gt;=</span><span class="number">2</span> <span class="keyword">and</span> temp.count_lat_lon <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h2 id="185-部门工资前三高的所有员工"><a href="#185-部门工资前三高的所有员工" class="headerlink" title="185. 部门工资前三高的所有员工"></a><strong>185. 部门工资前三高的所有员工</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">表: Employee</span><br><span class="line"></span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| id           | int     |</span><br><span class="line">| name         | varchar |</span><br><span class="line">| salary       | int     |</span><br><span class="line">| departmentId | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">Id是该表的主键列。</span><br><span class="line">departmentId是Department表中ID的外键。</span><br><span class="line">该表的每一行都表示员工的ID、姓名和工资。它还包含了他们部门的ID。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">表: Department</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| id          | int     |</span><br><span class="line">| name        | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">Id是该表的主键列。</span><br><span class="line">该表的每一行表示部门ID和部门名。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">公司的主管们感兴趣的是公司每个部门中谁赚的钱最多。一个部门的 高收入者 是指一个员工的工资在该部门的 不同 工资中 排名前三 。</span><br><span class="line"></span><br><span class="line">编写一个SQL查询，找出每个部门中 收入高的员工 。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式如下所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入: </span><br><span class="line">Employee 表:</span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| id | name  | salary | departmentId |</span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| 1  | Joe   | 85000  | 1            |</span><br><span class="line">| 2  | Henry | 80000  | 2            |</span><br><span class="line">| 3  | Sam   | 60000  | 2            |</span><br><span class="line">| 4  | Max   | 90000  | 1            |</span><br><span class="line">| 5  | Janet | 69000  | 1            |</span><br><span class="line">| 6  | Randy | 85000  | 1            |</span><br><span class="line">| 7  | Will  | 70000  | 1            |</span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">Department  表:</span><br><span class="line">+----+-------+</span><br><span class="line">| id | name  |</span><br><span class="line">+----+-------+</span><br><span class="line">| 1  | IT    |</span><br><span class="line">| 2  | Sales |</span><br><span class="line">+----+-------+</span><br><span class="line">输出: </span><br><span class="line">+------------+----------+--------+</span><br><span class="line">| Department | Employee | Salary |</span><br><span class="line">+------------+----------+--------+</span><br><span class="line">| IT         | Max      | 90000  |</span><br><span class="line">| IT         | Joe      | 85000  |</span><br><span class="line">| IT         | Randy    | 85000  |</span><br><span class="line">| IT         | Will     | 70000  |</span><br><span class="line">| Sales      | Henry    | 80000  |</span><br><span class="line">| Sales      | Sam      | 60000  |</span><br><span class="line">+------------+----------+--------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：窗口函数+联表</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span> dname <span class="keyword">as</span> Department ,name <span class="keyword">as</span> Employee ,a.salary</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> e.name ,</span><br><span class="line">    e.salary,</span><br><span class="line">    e.departmentId,</span><br><span class="line">    <span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> departmentId <span class="keyword">order</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span>) <span class="keyword">as</span> `rank`,</span><br><span class="line">    d.name <span class="keyword">as</span> dname</span><br><span class="line">    <span class="keyword">from</span> Employee e <span class="keyword">join</span> department d <span class="keyword">on</span> e.departmentId <span class="operator">=</span> d.id</span><br><span class="line">) a</span><br><span class="line"><span class="keyword">where</span> a.`rank`<span class="operator">&lt;=</span><span class="number">3</span> </span><br></pre></td></tr></table></figure>
<h1 id="高级字符串函数-正则表达式-子句"><a href="#高级字符串函数-正则表达式-子句" class="headerlink" title="高级字符串函数 &#x2F; 正则表达式 &#x2F; 子句"></a><strong>高级字符串函数 &#x2F; 正则表达式 &#x2F; 子句</strong></h1><h2 id="1667-修复表中的名字"><a href="#1667-修复表中的名字" class="headerlink" title="1667. 修复表中的名字"></a><strong>1667. 修复表中的名字</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">表： Users</span><br><span class="line"></span><br><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| user_id        | int     |</span><br><span class="line">| name           | varchar |</span><br><span class="line">+----------------+---------+</span><br><span class="line">user_id 是该表的主键。</span><br><span class="line">该表包含用户的 ID 和名字。名字仅由小写和大写字符组成。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写一个 SQL 查询来修复名字，使得只有第一个字符是大写的，其余都是小写的。</span><br><span class="line"></span><br><span class="line">返回按 user_id 排序的结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式示例如下。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Users table:</span><br><span class="line">+---------+-------+</span><br><span class="line">| user_id | name  |</span><br><span class="line">+---------+-------+</span><br><span class="line">| 1       | aLice |</span><br><span class="line">| 2       | bOB   |</span><br><span class="line">+---------+-------+</span><br><span class="line">输出：</span><br><span class="line">+---------+-------+</span><br><span class="line">| user_id | name  |</span><br><span class="line">+---------+-------+</span><br><span class="line">| 1       | Alice |</span><br><span class="line">| 2       | Bob   |</span><br><span class="line">+---------+-------+</span><br></pre></td></tr></table></figure>
<p><strong>字符串函数：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"># 一、计算字段</span><br><span class="line"></span><br><span class="line"># 其实本题主要考察的就是计算字段的使用。</span><br><span class="line"># 二、知识点</span><br><span class="line"># 2.1 CONCAT() 函数</span><br><span class="line"></span><br><span class="line"># CONCAT 可以将多个字符串拼接在一起。</span><br><span class="line"># 2.2 LEFT(str, length) 函数</span><br><span class="line"></span><br><span class="line"># 从左开始截取字符串，length 是截取的长度。</span><br><span class="line"># 2.3 UPPER(str) 与 LOWER(str)</span><br><span class="line"></span><br><span class="line"># UPPER(str) 将字符串中所有字符转为大写</span><br><span class="line"></span><br><span class="line"># LOWER(str) 将字符串中所有字符转为小写</span><br><span class="line"># 2.4 SUBSTRING(str, begin, end)</span><br><span class="line"></span><br><span class="line"># 截取字符串，end 不写默认为空。</span><br><span class="line"></span><br><span class="line"># SUBSTRING(name, 2) 从第二个截取到末尾，注意并不是下标，就是第二个。</span><br><span class="line"></span><br><span class="line"># CONCAT 用来拼接字符串 ● LEFT 从左边截取字符 ● RIGHT 从右边截取字符 ● UPPER 变为大写 ● LOWER 变为小写 ● LENGTH 获取字符串长度</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>代码如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span> user_id,</span><br><span class="line">concat(<span class="built_in">upper</span>(<span class="keyword">left</span>(name,<span class="number">1</span>)),<span class="built_in">lower</span>(<span class="built_in">substring</span>(name,<span class="number">2</span>))) <span class="keyword">as</span> name</span><br><span class="line"><span class="keyword">from</span> Users</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> user_id</span><br></pre></td></tr></table></figure>
<h2 id="1527-患某种疾病的患者"><a href="#1527-患某种疾病的患者" class="headerlink" title="1527. 患某种疾病的患者"></a><strong>1527. 患某种疾病的患者</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">患者信息表： Patients</span><br><span class="line"></span><br><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| patient_id   | int     |</span><br><span class="line">| patient_name | varchar |</span><br><span class="line">| conditions   | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">patient_id （患者 ID）是该表的主键。</span><br><span class="line">&#x27;conditions&#x27; （疾病）包含 0 个或以上的疾病代码，以空格分隔。</span><br><span class="line">这个表包含医院中患者的信息。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">写一条 SQL 语句，查询患有 I 类糖尿病的患者 ID （patient_id）、患者姓名（patient_name）以及其患有的所有疾病代码（conditions）。I 类糖尿病的代码总是包含前缀 DIAB1 。</span><br><span class="line"></span><br><span class="line">按 任意顺序 返回结果表。</span><br><span class="line"></span><br><span class="line">查询结果格式如下示例所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Patients表：</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| patient_id | patient_name | conditions   |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| 1          | Daniel       | YFEV COUGH   |</span><br><span class="line">| 2          | Alice        |              |</span><br><span class="line">| 3          | Bob          | DIAB100 MYOP |</span><br><span class="line">| 4          | George       | ACNE DIAB100 |</span><br><span class="line">| 5          | Alain        | DIAB201      |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">输出：</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| patient_id | patient_name | conditions   |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| 3          | Bob          | DIAB100 MYOP |</span><br><span class="line">| 4          | George       | ACNE DIAB100 | </span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">解释：Bob 和 George 都患有代码以 DIAB1 开头的疾病。</span><br></pre></td></tr></table></figure>
<p>解法：模糊查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> Patients</span><br><span class="line"><span class="keyword">where</span> conditions <span class="keyword">like</span> <span class="string">&#x27;% DIAB1%&#x27;</span> <span class="keyword">or</span> conditions <span class="keyword">like</span> <span class="string">&#x27;DIAB1%&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="196-删除重复的电子邮箱"><a href="#196-删除重复的电子邮箱" class="headerlink" title="196. 删除重复的电子邮箱"></a><strong>196. 删除重复的电子邮箱</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">表: Person</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| id          | int     |</span><br><span class="line">| email       | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">id是该表的主键列。</span><br><span class="line">该表的每一行包含一封电子邮件。电子邮件将不包含大写字母。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">编写一个 SQL 删除语句来 删除 所有重复的电子邮件，只保留一个id最小的唯一电子邮件。</span><br><span class="line"></span><br><span class="line">以 任意顺序 返回结果表。 （注意： 仅需要写删除语句，将自动对剩余结果进行查询）</span><br><span class="line"></span><br><span class="line">查询结果格式如下所示。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入: </span><br><span class="line">Person 表:</span><br><span class="line">+----+------------------+</span><br><span class="line">| id | email            |</span><br><span class="line">+----+------------------+</span><br><span class="line">| 1  | john@example.com |</span><br><span class="line">| 2  | bob@example.com  |</span><br><span class="line">| 3  | john@example.com |</span><br><span class="line">+----+------------------+</span><br><span class="line">输出: </span><br><span class="line">+----+------------------+</span><br><span class="line">| id | email            |</span><br><span class="line">+----+------------------+</span><br><span class="line">| 1  | john@example.com |</span><br><span class="line">| 2  | bob@example.com  |</span><br><span class="line">+----+------------------+</span><br><span class="line">解释: john@example.com重复两次。我们保留最小的Id = 1。</span><br></pre></td></tr></table></figure>
<p><strong>解法：where+delete</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">delete</span> p1 <span class="keyword">from</span>  Person p1,Person p2 <span class="keyword">where</span> p1.email <span class="operator">=</span> p2.email <span class="keyword">and</span> p1.id<span class="operator">&gt;</span>p2.id</span><br></pre></td></tr></table></figure>
<p><strong>解法：窗口函数</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Person</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">IN</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">SELECT</span> id <span class="keyword">FROM</span></span><br><span class="line">    (<span class="keyword">SELECT</span> id, <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> email <span class="keyword">ORDER</span> <span class="keyword">BY</span> id) <span class="keyword">AS</span> NUM</span><br><span class="line">    <span class="keyword">FROM</span> Person) T</span><br><span class="line">    <span class="keyword">WHERE</span> T.NUM <span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="176-第二高的薪水"><a href="#176-第二高的薪水" class="headerlink" title="176. 第二高的薪水"></a><strong>176. 第二高的薪水</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Employee 表：</span><br><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| id          | int  |</span><br><span class="line">| salary      | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">id 是这个表的主键。</span><br><span class="line">表的每一行包含员工的工资信息。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写一个 SQL 查询，获取并返回 Employee 表中第二高的薪水 。如果不存在第二高的薪水，查询应该返回 null 。</span><br><span class="line"></span><br><span class="line">查询结果如下例所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Employee 表：</span><br><span class="line">+----+--------+</span><br><span class="line">| id | salary |</span><br><span class="line">+----+--------+</span><br><span class="line">| 1  | 100    |</span><br><span class="line">| 2  | 200    |</span><br><span class="line">| 3  | 300    |</span><br><span class="line">+----+--------+</span><br><span class="line">输出：</span><br><span class="line">+---------------------+</span><br><span class="line">| SecondHighestSalary |</span><br><span class="line">+---------------------+</span><br><span class="line">| 200                 |</span><br><span class="line">+---------------------+</span><br><span class="line">示例 2：</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Employee 表：</span><br><span class="line">+----+--------+</span><br><span class="line">| id | salary |</span><br><span class="line">+----+--------+</span><br><span class="line">| 1  | 100    |</span><br><span class="line">+----+--------+</span><br><span class="line">输出：</span><br><span class="line">+---------------------+</span><br><span class="line">| SecondHighestSalary |</span><br><span class="line">+---------------------+</span><br><span class="line">| null                |</span><br><span class="line">+---------------------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：子查询+limit</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span>(</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> salary </span><br><span class="line"><span class="keyword">from</span> Employee</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span> </span><br><span class="line">limit <span class="number">1</span>,<span class="number">1</span></span><br><span class="line">)<span class="keyword">as</span> SecondHighestSalary</span><br></pre></td></tr></table></figure>
<p>为什么要用临时表，因为利用子查询的特性，如果查不到会返回null；<br><strong>解法二：ifnull（）</strong><br><strong>代码如下：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">select</span> ifnull(</span><br><span class="line">(<span class="keyword">select</span> <span class="keyword">distinct</span> salary </span><br><span class="line"><span class="keyword">from</span> Employee</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span> </span><br><span class="line">limit <span class="number">1</span>,<span class="number">1</span>),<span class="keyword">NULL</span>) <span class="keyword">as</span> SecondHighestSalary</span><br></pre></td></tr></table></figure>
<p>使用ifull也可以解决NULL问题</p>
<h2 id="1484-按日期分组销售产品"><a href="#1484-按日期分组销售产品" class="headerlink" title="1484. 按日期分组销售产品"></a><strong>1484. 按日期分组销售产品</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">表 Activities：</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| 列名         | 类型    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| sell_date   | date    |</span><br><span class="line">| product     | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">此表没有主键，它可能包含重复项。</span><br><span class="line">此表的每一行都包含产品名称和在市场上销售的日期。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">编写一个 SQL 查询来查找每个日期、销售的不同产品的数量及其名称。</span><br><span class="line">每个日期的销售产品名称应按词典序排列。</span><br><span class="line">返回按 sell_date 排序的结果表。</span><br><span class="line">查询结果格式如下例所示。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Activities 表：</span><br><span class="line">+------------+-------------+</span><br><span class="line">| sell_date  | product     |</span><br><span class="line">+------------+-------------+</span><br><span class="line">| 2020-05-30 | Headphone   |</span><br><span class="line">| 2020-06-01 | Pencil      |</span><br><span class="line">| 2020-06-02 | Mask        |</span><br><span class="line">| 2020-05-30 | Basketball  |</span><br><span class="line">| 2020-06-01 | Bible       |</span><br><span class="line">| 2020-06-02 | Mask        |</span><br><span class="line">| 2020-05-30 | T-Shirt     |</span><br><span class="line">+------------+-------------+</span><br><span class="line">输出：</span><br><span class="line">+------------+----------+------------------------------+</span><br><span class="line">| sell_date  | num_sold | products                     |</span><br><span class="line">+------------+----------+------------------------------+</span><br><span class="line">| 2020-05-30 | 3        | Basketball,Headphone,T-shirt |</span><br><span class="line">| 2020-06-01 | 2        | Bible,Pencil                 |</span><br><span class="line">| 2020-06-02 | 1        | Mask                         |</span><br><span class="line">+------------+----------+------------------------------+</span><br><span class="line">解释：</span><br><span class="line">对于2020-05-30，出售的物品是 (Headphone, Basketball, T-shirt)，按词典序排列，并用逗号 &#x27;,&#x27; 分隔。</span><br><span class="line">对于2020-06-01，出售的物品是 (Pencil, Bible)，按词典序排列，并用逗号分隔。</span><br><span class="line">对于2020-06-02，出售的物品是 (Mask)，只需返回该物品名。</span><br></pre></td></tr></table></figure>
<p><strong>解法：group_concat（）函数</strong><br><strong>组内拼接函数group_concat（）函数</strong><br><strong>代码如下：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">select sell_date,count(distinct product) as num_sold,</span><br><span class="line">group_concat(distinct product order by product asc separator &#x27;,&#x27;) as products</span><br><span class="line">from Activities</span><br><span class="line">group by sell_date</span><br><span class="line">order by sell_date</span><br></pre></td></tr></table></figure>
<h2 id="1327-列出指定时间段内所有的下单产品"><a href="#1327-列出指定时间段内所有的下单产品" class="headerlink" title="1327. 列出指定时间段内所有的下单产品"></a><strong>1327. 列出指定时间段内所有的下单产品</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">表: Products</span><br><span class="line"></span><br><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| product_id       | int     |</span><br><span class="line">| product_name     | varchar |</span><br><span class="line">| product_category | varchar |</span><br><span class="line">+------------------+---------+</span><br><span class="line">product_id 是该表主键。</span><br><span class="line">该表包含该公司产品的数据。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">表: Orders</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| order_date    | date    |</span><br><span class="line">| unit          | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">该表无主键，可能包含重复行。</span><br><span class="line">product_id 是表单 Products 的外键。</span><br><span class="line">unit 是在日期 order_date 内下单产品的数目。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">写一个 SQL 语句，要求获取在 2020 年 2 月份下单的数量不少于 100 的产品的名字和数目。</span><br><span class="line"></span><br><span class="line">返回结果表单的 顺序无要求 。</span><br><span class="line"></span><br><span class="line">查询结果的格式如下。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">示例 1:</span><br><span class="line"></span><br><span class="line">输入：</span><br><span class="line">Products 表:</span><br><span class="line">+-------------+-----------------------+------------------+</span><br><span class="line">| product_id  | product_name          | product_category |</span><br><span class="line">+-------------+-----------------------+------------------+</span><br><span class="line">| 1           | Leetcode Solutions    | Book             |</span><br><span class="line">| 2           | Jewels of Stringology | Book             |</span><br><span class="line">| 3           | HP                    | Laptop           |</span><br><span class="line">| 4           | Lenovo                | Laptop           |</span><br><span class="line">| 5           | Leetcode Kit          | T-shirt          |</span><br><span class="line">+-------------+-----------------------+------------------+</span><br><span class="line">Orders 表:</span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line">| product_id   | order_date   | unit     |</span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line">| 1            | 2020-02-05   | 60       |</span><br><span class="line">| 1            | 2020-02-10   | 70       |</span><br><span class="line">| 2            | 2020-01-18   | 30       |</span><br><span class="line">| 2            | 2020-02-11   | 80       |</span><br><span class="line">| 3            | 2020-02-17   | 2        |</span><br><span class="line">| 3            | 2020-02-24   | 3        |</span><br><span class="line">| 4            | 2020-03-01   | 20       |</span><br><span class="line">| 4            | 2020-03-04   | 30       |</span><br><span class="line">| 4            | 2020-03-04   | 60       |</span><br><span class="line">| 5            | 2020-02-25   | 50       |</span><br><span class="line">| 5            | 2020-02-27   | 50       |</span><br><span class="line">| 5            | 2020-03-01   | 50       |</span><br><span class="line">+--------------+--------------+----------+</span><br><span class="line">输出：</span><br><span class="line">+--------------------+---------+</span><br><span class="line">| product_name       | unit    |</span><br><span class="line">+--------------------+---------+</span><br><span class="line">| Leetcode Solutions | 130     |</span><br><span class="line">| Leetcode Kit       | 100     |</span><br><span class="line">+--------------------+---------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：联表+分组+having</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line">select p1.product_name ,sum(o1.unit) as unit</span><br><span class="line">from Products p1 join Orders o1</span><br><span class="line">on p1.product_id = o1.product_id</span><br><span class="line">where order_date LIKE &quot;2020-02%&quot;</span><br><span class="line">group by o1.product_id</span><br><span class="line">having  unit &gt;=100</span><br></pre></td></tr></table></figure>
<h2 id="1517-查找拥有有效邮箱的用户"><a href="#1517-查找拥有有效邮箱的用户" class="headerlink" title="1517. 查找拥有有效邮箱的用户"></a><strong>1517. 查找拥有有效邮箱的用户</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">用户表： Users</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| mail          | varchar | </span><br><span class="line">+---------------+---------+</span><br><span class="line">user_id （用户 ID）是该表的主键。</span><br><span class="line">这个表包含用户在某网站上注册的信息。有些邮箱是无效的。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">写一条 SQL 语句，查询拥有有效邮箱的用户。</span><br><span class="line"></span><br><span class="line">有效的邮箱包含符合下列条件的前缀名和域名：</span><br><span class="line"></span><br><span class="line">前缀名是包含字母（大写或小写）、数字、下划线 &#x27;_&#x27;、句点 &#x27;.&#x27; 和/或横杠 &#x27;-&#x27; 的字符串。前缀名必须以字母开头。</span><br><span class="line">域名是 &#x27;@leetcode.com&#x27; 。</span><br><span class="line">按任意顺序返回结果表。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">查询格式如下所示：</span><br><span class="line"></span><br><span class="line">Users</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| user_id | name      | mail                    |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| 1       | Winston   | winston@leetcode.com    |</span><br><span class="line">| 2       | Jonathan  | jonathanisgreat         |</span><br><span class="line">| 3       | Annabelle | bella-@leetcode.com     |</span><br><span class="line">| 4       | Sally     | sally.come@leetcode.com |</span><br><span class="line">| 5       | Marwan    | quarz#2020@leetcode.com |</span><br><span class="line">| 6       | David     | david69@gmail.com       |</span><br><span class="line">| 7       | Shapiro   | .shapo@leetcode.com     |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line"></span><br><span class="line">结果表：</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| user_id | name      | mail                    |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| 1       | Winston   | winston@leetcode.com    |</span><br><span class="line">| 3       | Annabelle | bella-@leetcode.com     |</span><br><span class="line">| 4       | Sally     | sally.come@leetcode.com |</span><br><span class="line">+---------+-----------+-------------------------+</span><br></pre></td></tr></table></figure>
<p><strong>解法：正则表达式</strong><br><strong>代码如下：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select *</span><br><span class="line">from users</span><br><span class="line">where mail regexp &#x27;^[a-zA-Z]+[a-zA-Z0-9_\\.\\/\\-]*@leetcode\\.com$&#x27;;</span><br></pre></td></tr></table></figure>
<p>REGEXP 就是 regular expression 正则表达式 的意思<br>^ 表示以后面的字符为开头 [] 表示括号内任意字符 - 表示连续 * 表示重复前面任意字符任意次数 \ 用来转义后面的特殊字符，以表示字符原本的样子，而不是将其作为特殊字符使用 $ 表示以前面的字符为结尾<br>前缀名以字母开头：^[a-zA-Z]<br>前缀名包含字母（大写或小写）、数字、下划线_、句点. 和 或 横杠-：[a-zA-Z0-9_.-]*<br>以域名‘@leetcode.com’结尾：@leetcode.com$</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Java Mdd</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/07/30/MySQL%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/">http://example.com/2023/07/30/MySQL%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">JavaMdd</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://img1.imgtp.com/2023/07/24/XnYi7kOl.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/07/31/%E5%89%91%E6%8C%87offer/" title="剑指offer刷题日记"><img class="cover" src="https://img1.imgtp.com/2023/07/24/WRsPSQ2X.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">剑指offer刷题日记</div></div></a></div><div class="next-post pull-right"><a href="/2023/07/27/%E9%B1%BC%E4%B8%B8API%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0/" title="鱼丸API开放平台"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">鱼丸API开放平台</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://img1.imgtp.com/2023/07/24/H1X3G9Nz.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Java Mdd</div><div class="author-info__description">程序东的个人博客</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mdd123cc"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mdd123cc" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:2195838553@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">hello! 这是我的个人博客，希望我的内容对你有帮助！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.</span> <span class="toc-text">查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#584-%E5%AF%BB%E6%89%BE%E7%94%A8%E6%88%B7%E6%8E%A8%E8%8D%90%E4%BA%BA"><span class="toc-number">1.1.</span> <span class="toc-text">584. 寻找用户推荐人</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#595-%E5%A4%A7%E7%9A%84%E5%9B%BD%E5%AE%B6"><span class="toc-number">1.2.</span> <span class="toc-text">595. 大的国家</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1148-%E6%96%87%E7%AB%A0%E6%B5%8F%E8%A7%88-I"><span class="toc-number">1.3.</span> <span class="toc-text">1148. 文章浏览 I</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1683-%E6%97%A0%E6%95%88%E7%9A%84%E6%8E%A8%E6%96%87"><span class="toc-number">1.4.</span> <span class="toc-text">1683. 无效的推文</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.</span> <span class="toc-text">连接</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1378-%E4%BD%BF%E7%94%A8%E5%94%AF%E4%B8%80%E6%A0%87%E8%AF%86%E7%A0%81%E6%9B%BF%E6%8D%A2%E5%91%98%E5%B7%A5ID"><span class="toc-number">2.1.</span> <span class="toc-text">1378. 使用唯一标识码替换员工ID</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1068-%E4%BA%A7%E5%93%81%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90-I"><span class="toc-number">2.2.</span> <span class="toc-text">1068. 产品销售分析 I</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1581-%E8%BF%9B%E5%BA%97%E5%8D%B4%E6%9C%AA%E8%BF%9B%E8%A1%8C%E8%BF%87%E4%BA%A4%E6%98%93%E7%9A%84%E9%A1%BE%E5%AE%A2"><span class="toc-number">2.3.</span> <span class="toc-text">1581. 进店却未进行过交易的顾客</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#197-%E4%B8%8A%E5%8D%87%E7%9A%84%E6%B8%A9%E5%BA%A6"><span class="toc-number">2.4.</span> <span class="toc-text">197. 上升的温度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1661-%E6%AF%8F%E5%8F%B0%E6%9C%BA%E5%99%A8%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%B9%B3%E5%9D%87%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="toc-number">2.5.</span> <span class="toc-text">1661. 每台机器的进程平均运行时间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#577-%E5%91%98%E5%B7%A5%E5%A5%96%E9%87%91"><span class="toc-number">2.6.</span> <span class="toc-text">577. 员工奖金</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1280-%E5%AD%A6%E7%94%9F%E4%BB%AC%E5%8F%82%E5%8A%A0%E5%90%84%E7%A7%91%E6%B5%8B%E8%AF%95%E7%9A%84%E6%AC%A1%E6%95%B0"><span class="toc-number">2.7.</span> <span class="toc-text">1280. 学生们参加各科测试的次数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#570-%E8%87%B3%E5%B0%91%E6%9C%895%E5%90%8D%E7%9B%B4%E6%8E%A5%E4%B8%8B%E5%B1%9E%E7%9A%84%E7%BB%8F%E7%90%86"><span class="toc-number">2.8.</span> <span class="toc-text">570. 至少有5名直接下属的经理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1934-%E7%A1%AE%E8%AE%A4%E7%8E%87"><span class="toc-number">2.9.</span> <span class="toc-text">1934. 确认率</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#620-%E6%9C%89%E8%B6%A3%E7%9A%84%E7%94%B5%E5%BD%B1"><span class="toc-number">3.1.</span> <span class="toc-text">620. 有趣的电影</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1251-%E5%B9%B3%E5%9D%87%E5%94%AE%E4%BB%B7"><span class="toc-number">3.2.</span> <span class="toc-text">1251. 平均售价</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1075-%E9%A1%B9%E7%9B%AE%E5%91%98%E5%B7%A5-I"><span class="toc-number">3.3.</span> <span class="toc-text">1075. 项目员工 I</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1633-%E5%90%84%E8%B5%9B%E4%BA%8B%E7%9A%84%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E7%8E%87"><span class="toc-number">3.4.</span> <span class="toc-text">1633. 各赛事的用户注册率</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1211-%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E7%9A%84%E8%B4%A8%E9%87%8F%E5%92%8C%E5%8D%A0%E6%AF%94"><span class="toc-number">3.5.</span> <span class="toc-text">1211. 查询结果的质量和占比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1193-%E6%AF%8F%E6%9C%88%E4%BA%A4%E6%98%93-I"><span class="toc-number">3.6.</span> <span class="toc-text">1193. 每月交易 I</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1174-%E5%8D%B3%E6%97%B6%E9%A3%9F%E7%89%A9%E9%85%8D%E9%80%81-II"><span class="toc-number">3.7.</span> <span class="toc-text">1174. 即时食物配送 II</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F%E7%8E%A9%E6%B3%95%E5%88%86%E6%9E%90-IV"><span class="toc-number">3.8.</span> <span class="toc-text">游戏玩法分析 IV</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E5%92%8C%E5%88%86%E7%BB%84"><span class="toc-number">4.</span> <span class="toc-text">排序和分组</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2356-%E6%AF%8F%E4%BD%8D%E6%95%99%E5%B8%88%E6%89%80%E6%95%99%E6%8E%88%E7%9A%84%E7%A7%91%E7%9B%AE%E7%A7%8D%E7%B1%BB%E7%9A%84%E6%95%B0%E9%87%8F"><span class="toc-number">4.1.</span> <span class="toc-text">2356. 每位教师所教授的科目种类的数量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1141-%E6%9F%A5%E8%AF%A2%E8%BF%9130%E5%A4%A9%E6%B4%BB%E8%B7%83%E7%94%A8%E6%88%B7%E6%95%B0"><span class="toc-number">4.2.</span> <span class="toc-text">1141. 查询近30天活跃用户数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1084-%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90III"><span class="toc-number">4.3.</span> <span class="toc-text">1084. 销售分析III</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#596-%E8%B6%85%E8%BF%875%E5%90%8D%E5%AD%A6%E7%94%9F%E7%9A%84%E8%AF%BE"><span class="toc-number">4.4.</span> <span class="toc-text">596. 超过5名学生的课</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1729-%E6%B1%82%E5%85%B3%E6%B3%A8%E8%80%85%E7%9A%84%E6%95%B0%E9%87%8F"><span class="toc-number">4.5.</span> <span class="toc-text">1729. 求关注者的数量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#619-%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%9C%80%E5%A4%A7%E6%95%B0%E5%AD%97"><span class="toc-number">4.6.</span> <span class="toc-text">619. 只出现一次的最大数字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1045-%E4%B9%B0%E4%B8%8B%E6%89%80%E6%9C%89%E4%BA%A7%E5%93%81%E7%9A%84%E5%AE%A2%E6%88%B7"><span class="toc-number">4.7.</span> <span class="toc-text">1045. 买下所有产品的客户</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2%E5%92%8C%E8%BF%9E%E6%8E%A5"><span class="toc-number">5.</span> <span class="toc-text">高级查询和连接</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1731-%E6%AF%8F%E4%BD%8D%E7%BB%8F%E7%90%86%E7%9A%84%E4%B8%8B%E5%B1%9E%E5%91%98%E5%B7%A5%E6%95%B0%E9%87%8F"><span class="toc-number">5.1.</span> <span class="toc-text">1731. 每位经理的下属员工数量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1789-%E5%91%98%E5%B7%A5%E7%9A%84%E7%9B%B4%E5%B1%9E%E9%83%A8%E9%97%A8"><span class="toc-number">5.2.</span> <span class="toc-text">1789. 员工的直属部门</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#610-%E5%88%A4%E6%96%AD%E4%B8%89%E8%A7%92%E5%BD%A2"><span class="toc-number">5.3.</span> <span class="toc-text">610. 判断三角形</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#180-%E8%BF%9E%E7%BB%AD%E5%87%BA%E7%8E%B0%E7%9A%84%E6%95%B0%E5%AD%97"><span class="toc-number">5.4.</span> <span class="toc-text">180. 连续出现的数字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1164-%E6%8C%87%E5%AE%9A%E6%97%A5%E6%9C%9F%E7%9A%84%E4%BA%A7%E5%93%81%E4%BB%B7%E6%A0%BC%EF%BC%88%E9%9A%BE%EF%BC%81%EF%BC%89"><span class="toc-number">5.5.</span> <span class="toc-text">1164. 指定日期的产品价格（难！）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1204-%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E8%83%BD%E8%BF%9B%E5%85%A5%E7%94%B5%E6%A2%AF%E7%9A%84%E4%BA%BA"><span class="toc-number">5.6.</span> <span class="toc-text">1204. 最后一个能进入电梯的人</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1907-%E6%8C%89%E5%88%86%E7%B1%BB%E7%BB%9F%E8%AE%A1%E8%96%AA%E6%B0%B4"><span class="toc-number">5.7.</span> <span class="toc-text">1907. 按分类统计薪水</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.</span> <span class="toc-text">子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1978-%E4%B8%8A%E7%BA%A7%E7%BB%8F%E7%90%86%E5%B7%B2%E7%A6%BB%E8%81%8C%E7%9A%84%E5%85%AC%E5%8F%B8%E5%91%98%E5%B7%A5"><span class="toc-number">6.1.</span> <span class="toc-text">1978. 上级经理已离职的公司员工</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#626-%E6%8D%A2%E5%BA%A7%E4%BD%8D"><span class="toc-number">6.2.</span> <span class="toc-text">626. 换座位</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1341-%E7%94%B5%E5%BD%B1%E8%AF%84%E5%88%86"><span class="toc-number">6.3.</span> <span class="toc-text">1341. 电影评分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1321-%E9%A4%90%E9%A6%86%E8%90%A5%E4%B8%9A%E9%A2%9D%E5%8F%98%E5%8C%96%E5%A2%9E%E9%95%BF"><span class="toc-number">6.4.</span> <span class="toc-text">1321. 餐馆营业额变化增长</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#602-%E5%A5%BD%E5%8F%8B%E7%94%B3%E8%AF%B7-II-%EF%BC%9A%E8%B0%81%E6%9C%89%E6%9C%80%E5%A4%9A%E7%9A%84%E5%A5%BD%E5%8F%8B"><span class="toc-number">6.5.</span> <span class="toc-text">602. 好友申请 II ：谁有最多的好友</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#585-2016%E5%B9%B4%E7%9A%84%E6%8A%95%E8%B5%84"><span class="toc-number">6.6.</span> <span class="toc-text">585. 2016年的投资</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#185-%E9%83%A8%E9%97%A8%E5%B7%A5%E8%B5%84%E5%89%8D%E4%B8%89%E9%AB%98%E7%9A%84%E6%89%80%E6%9C%89%E5%91%98%E5%B7%A5"><span class="toc-number">6.7.</span> <span class="toc-text">185. 部门工资前三高的所有员工</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F-%E5%AD%90%E5%8F%A5"><span class="toc-number">7.</span> <span class="toc-text">高级字符串函数 &#x2F; 正则表达式 &#x2F; 子句</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1667-%E4%BF%AE%E5%A4%8D%E8%A1%A8%E4%B8%AD%E7%9A%84%E5%90%8D%E5%AD%97"><span class="toc-number">7.1.</span> <span class="toc-text">1667. 修复表中的名字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1527-%E6%82%A3%E6%9F%90%E7%A7%8D%E7%96%BE%E7%97%85%E7%9A%84%E6%82%A3%E8%80%85"><span class="toc-number">7.2.</span> <span class="toc-text">1527. 患某种疾病的患者</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#196-%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D%E7%9A%84%E7%94%B5%E5%AD%90%E9%82%AE%E7%AE%B1"><span class="toc-number">7.3.</span> <span class="toc-text">196. 删除重复的电子邮箱</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#176-%E7%AC%AC%E4%BA%8C%E9%AB%98%E7%9A%84%E8%96%AA%E6%B0%B4"><span class="toc-number">7.4.</span> <span class="toc-text">176. 第二高的薪水</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1484-%E6%8C%89%E6%97%A5%E6%9C%9F%E5%88%86%E7%BB%84%E9%94%80%E5%94%AE%E4%BA%A7%E5%93%81"><span class="toc-number">7.5.</span> <span class="toc-text">1484. 按日期分组销售产品</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1327-%E5%88%97%E5%87%BA%E6%8C%87%E5%AE%9A%E6%97%B6%E9%97%B4%E6%AE%B5%E5%86%85%E6%89%80%E6%9C%89%E7%9A%84%E4%B8%8B%E5%8D%95%E4%BA%A7%E5%93%81"><span class="toc-number">7.6.</span> <span class="toc-text">1327. 列出指定时间段内所有的下单产品</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1517-%E6%9F%A5%E6%89%BE%E6%8B%A5%E6%9C%89%E6%9C%89%E6%95%88%E9%82%AE%E7%AE%B1%E7%9A%84%E7%94%A8%E6%88%B7"><span class="toc-number">7.7.</span> <span class="toc-text">1517. 查找拥有有效邮箱的用户</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/08/15/ConcurrentHashMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="ConcurrentHashMap源码分析"><img src="https://img1.imgtp.com/2023/07/31/MJzAzvCO.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ConcurrentHashMap源码分析"/></a><div class="content"><a class="title" href="/2023/08/15/ConcurrentHashMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="ConcurrentHashMap源码分析">ConcurrentHashMap源码分析</a><time datetime="2023-08-15T04:12:26.584Z" title="发表于 2023-08-15 12:12:26">2023-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/15/HashMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="HashMap源码分析"><img src="https://img1.imgtp.com/2023/07/31/vrQpCK4Z.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HashMap源码分析"/></a><div class="content"><a class="title" href="/2023/08/15/HashMap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="HashMap源码分析">HashMap源码分析</a><time datetime="2023-08-15T04:10:45.559Z" title="发表于 2023-08-15 12:10:45">2023-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/15/LinkedList%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="LinkedList 源码分析"><img src="https://img1.imgtp.com/2023/07/24/J6yvhb1B.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LinkedList 源码分析"/></a><div class="content"><a class="title" href="/2023/08/15/LinkedList%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="LinkedList 源码分析">LinkedList 源码分析</a><time datetime="2023-08-15T04:09:39.718Z" title="发表于 2023-08-15 12:09:39">2023-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/15/ArrayList%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="ArrayList源码分析"><img src="https://img1.imgtp.com/2023/07/24/J6yvhb1B.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ArrayList源码分析"/></a><div class="content"><a class="title" href="/2023/08/15/ArrayList%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="ArrayList源码分析">ArrayList源码分析</a><time datetime="2023-08-15T04:08:28.734Z" title="发表于 2023-08-15 12:08:28">2023-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/31/%E5%89%91%E6%8C%87offer/" title="剑指offer刷题日记"><img src="https://img1.imgtp.com/2023/07/24/WRsPSQ2X.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="剑指offer刷题日记"/></a><div class="content"><a class="title" href="/2023/07/31/%E5%89%91%E6%8C%87offer/" title="剑指offer刷题日记">剑指offer刷题日记</a><time datetime="2023-07-31T04:06:30.810Z" title="发表于 2023-07-31 12:06:30">2023-07-31</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://img1.imgtp.com/2023/07/24/XnYi7kOl.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Java Mdd</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>